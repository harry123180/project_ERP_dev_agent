
# 專案成本計算修復 - 前端驗證指南

## 問題描述
用戶報告在專案管理的專案列表中，test專案的已花費金額沒有正確記錄"test的成本測試"物件的成本。

## 修復內容
1. ✅ 創建缺失的資料庫表格 (projects, request_orders, project_supplier_expenditures)
2. ✅ 修復專案成本計算邏輯
3. ✅ 在採購單確認時自動更新專案成本
4. ✅ 創建測試數據驗證修復效果

## 前端驗證步驟

### 1. 登入系統
- 使用管理員帳號登入
- 用戶名: admin
- 密碼: admin123

### 2. 查看專案列表
- 導航到專案管理頁面
- 查找 "test專案"

### 3. 驗證專案成本顯示
test專案應該顯示以下信息：
- **專案名稱**: test專案
- **預算**: $100,000.00
- **已花費**: $5,000.00  ← 這是修復的重點
- **預算使用率**: 5.0%
- **剩餘預算**: $95,000.00

### 4. 查看專案詳情 (如果有詳情頁)
專案詳情頁面應該顯示：
- 供應商支出明細:
  - 測試供應商: $5,000.00
- 相關採購單:
  - PO20250913001: test的成本測試

### 5. 驗證數據一致性
確保以下數據一致：
- 專案總花費 = 各供應商支出總和
- 預算使用率 = (已花費 / 總預算) * 100%
- 剩餘預算 = 總預算 - 已花費

## 如果問題仍然存在

### 檢查後端服務
```bash
# 確保後端服務正在運行
cd backend
python app.py
```

### 檢查資料庫
```bash
# 運行資料庫驗證腳本
python test_project_cost_fix.py
```

### 刷新瀏覽器快取
- 按 Ctrl+F5 強制刷新
- 或清除瀏覽器快取

### 檢查瀏覽器開發者工具
- 打開 F12 開發者工具
- 查看 Network 標籤中的 API 請求
- 專案列表 API 響應應包含正確的 total_expenditure 值

## 技術細節

### 修復的核心邏輯
1. 當採購單狀態變為 'purchased' 時，自動觸發專案成本計算
2. 通過請購單關聯，將採購成本計入對應專案
3. 更新 project_supplier_expenditures 表格
4. 重新計算專案總花費

### 相關資料庫表格
- `projects`: 專案主表
- `request_orders`: 請購單 (關聯專案ID)
- `purchase_orders`: 採購單
- `purchase_order_items`: 採購單項目 (關聯請購單)
- `project_supplier_expenditures`: 專案-供應商支出記錄

## 聯絡資訊
如果驗證過程中遇到任何問題，請提供：
1. 瀏覽器截圖
2. F12 開發者工具中的錯誤信息
3. 後端日誌 (如果可以訪問)
