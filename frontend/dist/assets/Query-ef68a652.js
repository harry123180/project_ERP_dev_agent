import{d as _e,y as fe,r as y,a as Q,p as F,z as Z,a1 as pe,c as C,b as d,e,w as a,Y as $,X as b,al as ce,T as me,o as c,i as r,f as U,F as S,s as L,q as T,g as h,a9 as ve,ay as ye,t as _,ap as be,aP as ge,b7 as he,b8 as we,b9 as Ve,m as ke,j as xe,k as qe,E as Ee,ah as Ie,ai as ze,I as Ce,av as Ue,ao as Te,a_ as De,aw as Re,aO as Fe,aF as $e,aS as Se,_ as Le}from"./index-61294aba.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                 *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                *//* empty css                  *//* empty css                     *//* empty css                  */const je={class:"inventory-query"},Be={class:"search-section"},Oe={class:"card-header"},Ae={class:"results-section"},Ke={class:"card-header"},Qe={class:"item-info"},Ze={class:"item-name"},Me={class:"item-spec-column"},Ne=_e({__name:"Query",setup(Pe){const j=fe(),q=y(!1),E=y([]),w=y([]),o=Q({name:"",spec:"",request_no:"",po_no:"",zone:"",shelf:"",floor:void 0}),M=F(()=>w.value.map(n=>n.area_code)),B=F(()=>{if(!o.zone)return[];const n=w.value.find(t=>t.area_code===o.zone);return n?n.shelves.map(t=>t.shelf_code):[]}),O=F(()=>{if(!o.zone||!o.shelf)return[];const n=w.value.find(s=>s.area_code===o.zone);if(!n)return[];const t=n.shelves.find(s=>s.shelf_code===o.shelf);return t?t.floors.map(s=>s.floor_level):[]});Z(()=>o.zone,n=>{n?o.shelf&&!B.value.includes(o.shelf)&&(o.shelf="",o.floor=void 0):(o.shelf="",o.floor=void 0)}),Z(()=>o.shelf,n=>{n?o.floor&&!O.value.includes(o.floor)&&(o.floor=void 0):o.floor=void 0});const V=y(!1),D=y(!1),k=y(null),i=Q({quantity:0,usage_type:"daily",note:""}),A=y(),N={quantity:[{required:!0,message:"請輸入領用數量",trigger:"blur"},{type:"number",min:.01,message:"領用數量必須大於0",trigger:"blur"}],usage_type:[{required:!0,message:"請選擇用途類型",trigger:"change"}]},P=async()=>{try{const n=await $.getStorageTree();w.value=n}catch(n){console.error("Failed to load storage tree:",n),w.value=[{area_code:"Z1",shelves:[{shelf_code:"A",floors:[{floor_level:1},{floor_level:2},{floor_level:3}]},{shelf_code:"B",floors:[{floor_level:1},{floor_level:2},{floor_level:3}]}]},{area_code:"Z2",shelves:[{shelf_code:"A",floors:[{floor_level:1},{floor_level:2},{floor_level:3}]},{shelf_code:"B",floors:[{floor_level:1},{floor_level:2},{floor_level:3}]}]}]}},f=async()=>{try{q.value=!0;const n={};o.name&&(n.name=o.name),o.spec&&(n.spec=o.spec),o.request_no&&(n.request_no=o.request_no),o.po_no&&(n.po_no=o.po_no),o.zone&&(n.zone=o.zone),o.shelf&&(n.shelf=o.shelf),o.floor&&(n.floor=o.floor);const t=await $.getInventoryItemsGrouped(n);E.value=t,t.length===0?b.info("未找到符合條件的庫存資料"):b.success(`找到 ${t.length} 筆庫存資料`)}catch(n){console.error("Query inventory error:",n),b.error("查詢庫存失敗")}finally{q.value=!1}},G=()=>{Object.assign(o,{name:"",spec:"",request_no:"",po_no:"",zone:"",shelf:"",floor:void 0}),f()},W=()=>{f()},H=n=>{j.push(`/inventory/items/${encodeURIComponent(n.item_key)}/details`)},X=n=>{j.push(`/inventory/items/${encodeURIComponent(n.item_key)}/details?tab=history`)},Y=n=>{k.value=n,i.quantity=1,i.usage_type="daily",i.note="",V.value=!0},J=async()=>{var n;try{await((n=A.value)==null?void 0:n.validate()),D.value=!0,b.info("批次物料領用功能將在後續版本中實現，請使用詳情頁面進行操作"),V.value=!1}catch{b.error("物料領用失敗")}finally{D.value=!1}},ee=async()=>{try{const n=await $.exportInventory(o),t=window.URL.createObjectURL(n),s=document.createElement("a");s.href=t,s.download=`inventory_${new Date().toISOString().split("T")[0]}.xlsx`,s.click(),window.URL.revokeObjectURL(t),b.success("匯出成功")}catch{b.error("匯出失敗")}},le=n=>n?new Date(n).toLocaleDateString("zh-TW"):"-",te=n=>n<=0?"danger":n<=10?"warning":"success",ae=n=>{switch(n){case"daily":return"info";case"project":return"warning";case"production":return"success";case"maintenance":return"danger";default:return""}},oe=n=>({daily:"日常使用",project:"專案使用",production:"生產用",maintenance:"維護用",office:"辦公用",it:"IT設備"})[n]||n||"一般";return pe(async()=>{await P(),f()}),(n,t)=>{const s=ke,m=xe,u=qe,R=Ee,x=Ie,I=ze,g=Ce,K=ce,p=Ue,z=Te,ne=De,se=Re,re=Fe,ue=$e,ie=me,de=Se;return c(),C("div",je,[d("div",Be,[e(K,{class:"filter-card"},{header:a(()=>[d("div",Oe,[t[13]||(t[13]=d("span",null,"庫存查詢條件",-1)),e(s,{size:"small",onClick:G},{default:a(()=>[...t[12]||(t[12]=[r("重置",-1)])]),_:1})])]),default:a(()=>[e(R,{model:o,"label-width":"100px",inline:!0},{default:a(()=>[e(u,{label:"物料名稱"},{default:a(()=>[e(m,{modelValue:o.name,"onUpdate:modelValue":t[0]||(t[0]=l=>o.name=l),placeholder:"輸入物料名稱",clearable:"",style:{width:"200px"},onKeyup:U(f,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"規格說明"},{default:a(()=>[e(m,{modelValue:o.spec,"onUpdate:modelValue":t[1]||(t[1]=l=>o.spec=l),placeholder:"輸入規格說明",clearable:"",style:{width:"200px"},onKeyup:U(f,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"請購單號"},{default:a(()=>[e(m,{modelValue:o.request_no,"onUpdate:modelValue":t[2]||(t[2]=l=>o.request_no=l),placeholder:"輸入請購單號",clearable:"",style:{width:"200px"},onKeyup:U(f,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"採購單號"},{default:a(()=>[e(m,{modelValue:o.po_no,"onUpdate:modelValue":t[3]||(t[3]=l=>o.po_no=l),placeholder:"輸入採購單號",clearable:"",style:{width:"200px"},onKeyup:U(f,["enter"])},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e(R,{model:o,"label-width":"100px",inline:!0},{default:a(()=>[e(u,{label:"儲存區域"},{default:a(()=>[e(I,{modelValue:o.zone,"onUpdate:modelValue":t[4]||(t[4]=l=>o.zone=l),placeholder:"選擇區域",clearable:"",style:{width:"120px"}},{default:a(()=>[(c(!0),C(S,null,L(M.value,l=>(c(),T(x,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"貨架"},{default:a(()=>[e(I,{modelValue:o.shelf,"onUpdate:modelValue":t[5]||(t[5]=l=>o.shelf=l),placeholder:"選擇貨架",clearable:"",style:{width:"100px"}},{default:a(()=>[(c(!0),C(S,null,L(B.value,l=>(c(),T(x,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"樓層"},{default:a(()=>[e(I,{modelValue:o.floor,"onUpdate:modelValue":t[6]||(t[6]=l=>o.floor=l),placeholder:"選擇樓層",clearable:"",style:{width:"100px"}},{default:a(()=>[(c(!0),C(S,null,L(O.value,l=>(c(),T(x,{key:l,label:`第${l}層`,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:a(()=>[e(s,{type:"primary",onClick:f,loading:q.value},{default:a(()=>[e(g,null,{default:a(()=>[e(h(ve))]),_:1}),t[14]||(t[14]=r(" 查詢 ",-1))]),_:1},8,["loading"]),e(s,{onClick:ee,disabled:!E.value.length},{default:a(()=>[e(g,null,{default:a(()=>[e(h(ye))]),_:1}),t[15]||(t[15]=r(" 匯出 ",-1))]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),d("div",Ae,[e(K,null,{header:a(()=>[d("div",Ke,[d("span",null,"庫存清單 ("+_(E.value.length)+" 筆)",1),d("div",null,[e(s,{size:"small",onClick:W},{default:a(()=>[e(g,null,{default:a(()=>[e(h(be))]),_:1}),t[16]||(t[16]=r(" 重新整理 ",-1))]),_:1})])])]),default:a(()=>[ge((c(),T(se,{data:E.value,stripe:""},{default:a(()=>[e(p,{prop:"item_name",label:"物料名稱",width:"180"},{default:a(({row:l})=>[d("div",Qe,[d("div",Ze,_(l.item_name),1)])]),_:1}),e(p,{prop:"item_specification",label:"規格",width:"200"},{default:a(({row:l})=>[d("div",Me,_(l.item_specification||"-"),1)]),_:1}),e(p,{prop:"usage_type",label:"用途",width:"100",align:"center"},{default:a(({row:l})=>[e(z,{size:"small",type:ae(l.usage_type)},{default:a(()=>[r(_(oe(l.usage_type)),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"total_quantity",label:"總庫存數量",width:"120",align:"right"},{default:a(({row:l})=>[e(z,{type:te(l.total_quantity)},{default:a(()=>[r(_(l.total_quantity)+" "+_(l.unit),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"batch_count",label:"批次數量",width:"90",align:"center"},{default:a(({row:l})=>[e(ne,{value:l.batch_count,type:"primary"},{default:a(()=>[e(z,{size:"small",type:"info"},{default:a(()=>[r(_(l.batch_count)+" 批",1)]),_:2},1024)]),_:2},1032,["value"])]),_:1}),e(p,{prop:"storage_location_count",label:"儲存位置",width:"100",align:"center"},{default:a(({row:l})=>[e(z,{size:"small",type:"success"},{default:a(()=>[r(_(l.storage_location_count)+" 個位置",1)]),_:2},1024)]),_:1}),e(p,{prop:"last_received_date",label:"最近收貨",width:"100"},{default:a(({row:l})=>[r(_(le(l.last_received_date)),1)]),_:1}),e(p,{label:"操作",width:"240",fixed:"right"},{default:a(({row:l})=>[e(s,{size:"small",type:"primary",onClick:v=>H(l)},{default:a(()=>[e(g,null,{default:a(()=>[e(h(he))]),_:1}),t[17]||(t[17]=r(" 詳情 ",-1))]),_:1},8,["onClick"]),e(s,{size:"small",type:"info",onClick:v=>X(l)},{default:a(()=>[e(g,null,{default:a(()=>[e(h(we))]),_:1}),t[18]||(t[18]=r(" 履歷 ",-1))]),_:1},8,["onClick"]),e(s,{size:"small",onClick:v=>Y(l)},{default:a(()=>[e(g,null,{default:a(()=>[e(h(Ve))]),_:1}),t[19]||(t[19]=r(" 領用 ",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,q.value]])]),_:1})]),e(ie,{modelValue:V.value,"onUpdate:modelValue":t[11]||(t[11]=l=>V.value=l),title:"物料領用",width:"500px"},{footer:a(()=>[e(s,{onClick:t[10]||(t[10]=l=>V.value=!1)},{default:a(()=>[...t[20]||(t[20]=[r("取消",-1)])]),_:1}),e(s,{type:"primary",onClick:J,loading:D.value},{default:a(()=>[...t[21]||(t[21]=[r("確認領用",-1)])]),_:1},8,["loading"])]),default:a(()=>[e(R,{model:i,rules:N,ref_key:"issueFormRef",ref:A,"label-width":"100px"},{default:a(()=>[e(u,{label:"物料名稱"},{default:a(()=>{var l;return[e(m,{value:(l=k.value)==null?void 0:l.item_name,disabled:""},null,8,["value"])]}),_:1}),e(u,{label:"可用數量"},{default:a(()=>{var l,v;return[e(m,{value:`${((l=k.value)==null?void 0:l.total_quantity)||0} ${((v=k.value)==null?void 0:v.unit)||""}`,disabled:""},null,8,["value"])]}),_:1}),e(re,{title:"注意",description:"此物料有多個批次，請前往詳情頁面選擇特定批次進行領用",type:"info","show-icon":"",closable:!1,style:{"margin-bottom":"15px"}}),e(u,{label:"領用數量",prop:"quantity"},{default:a(()=>{var l;return[e(ue,{modelValue:i.quantity,"onUpdate:modelValue":t[7]||(t[7]=v=>i.quantity=v),min:.01,max:((l=k.value)==null?void 0:l.current_quantity)||0,precision:2,style:{width:"100%"}},null,8,["modelValue","max"])]}),_:1}),e(u,{label:"用途類型",prop:"usage_type"},{default:a(()=>[e(I,{modelValue:i.usage_type,"onUpdate:modelValue":t[8]||(t[8]=l=>i.usage_type=l),style:{width:"100%"}},{default:a(()=>[e(x,{label:"日常使用",value:"daily"}),e(x,{label:"專案使用",value:"project"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"備註"},{default:a(()=>[e(m,{modelValue:i.note,"onUpdate:modelValue":t[9]||(t[9]=l=>i.note=l),type:"textarea",rows:"3"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const il=Le(Ne,[["__scopeId","data-v-baa1e8e3"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/inventory/Query.vue"]]);export{il as default};
//# sourceMappingURL=Query-ef68a652.js.map
