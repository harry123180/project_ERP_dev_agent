import{d as ue,n as ce,y as pe,u as de,r as H,p as f,a1 as _e,c as v,e as a,w as t,g as _,q as p,ab as c,X as M,al as me,T as fe,o as l,b as k,i as n,aG as ve,aH as ye,aI as ge,t as i,H as he,m as be,aJ as we,ao as ke,aK as qe,aj as Se,a4 as Re,av as Te,aw as De,aL as Ee,_ as Ce}from"./index-61294aba.js";/* empty css                  *//* empty css                   *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css               *//* empty css                *//* empty css                             *//* empty css                         *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                      *//* empty css                  *//* empty css                     *//* empty css                             */import{b as Me,S as G}from"./StatusTag-84a15be2.js";import{P as xe}from"./ConfirmDialog.vue_vue_type_style_index_0_scoped_d3e333dd_lang-31e88244.js";/* empty css                       *//* empty css                 *//* empty css                          *//* empty css                  *//* empty css                        */import{S as q}from"./StatCard-8d66908e.js";import{R as Be}from"./Review-1a7e7b04.js";import{u as Pe}from"./requisition-cf919b83.js";/* empty css                           *//* empty css                    *//* empty css                        *//* empty css                         *//* empty css                 */const Ae={class:"requisition-detail"},Ve={class:"detail-actions"},ze={key:0,class:"loading-container"},je={key:1,class:"detail-content"},Ie={key:0,class:"money"},Ne={key:1},Ue={key:0,class:"money"},We={key:1},Fe=ue({__name:"Detail",setup(He){const K=ce(),S=pe(),R=Pe(),y=de(),T=H(!1),g=H(!1),h=f(()=>K.params.id),e=f(()=>R.currentRequisition),L=f(()=>{var s;return((s=e.value)==null?void 0:s.items)||[]}),O=f(()=>{var s;return e.value?e.value.order_status==="draft"&&(y.hasRole("Admin")||((s=y.user)==null?void 0:s.user_id)===e.value.requester_id):!1}),J=f(()=>{var s;return e.value?e.value.order_status==="draft"&&(y.hasRole("Admin")||((s=y.user)==null?void 0:s.user_id)===e.value.requester_id):!1}),Q=f(()=>e.value?e.value.order_status==="submitted"&&y.hasRole("Admin","ProcurementMgr","Procurement"):!1),x=f(()=>e.value?e.value.purchase_status&&e.value.purchase_status!=="none":!1),X=s=>Me[s||""]||"",D=s=>s?new Date(s).toLocaleString("zh-TW"):"-",B=s=>new Intl.NumberFormat("zh-TW",{style:"currency",currency:"TWD",minimumFractionDigits:0}).format(s),Y=s=>({office:"辦公用品",electronic:"電子設備",furniture:"辦公家具",consumable:"耗材用品",tool:"工具設備",other:"其他"})[s]||s||"-",P=s=>({none:"未製單",created:"已製單",purchasing:"採購中",purchased:"已採購",shipped:"已發貨",in_transit:"物流中",arrived:"已到貨"})[s||"none"]||"未製單",A=s=>({none:"info",created:"warning",purchasing:"warning",purchased:"primary",shipped:"primary",in_transit:"warning",arrived:"success"})[s||"none"]||"info",V=s=>({pending:"待入庫",partial:"部分入庫",completed:"已入庫"})[s||"pending"]||"待入庫",z=s=>({pending:"warning",partial:"primary",completed:"success"})[s||"pending"]||"warning",j=s=>({pending:"待驗收",inspecting:"驗收中",passed:"驗收合格",failed:"驗收不合格",partial:"部分驗收"})[s||"pending"]||"待驗收",I=s=>({pending:"warning",inspecting:"primary",passed:"success",failed:"danger",partial:"warning"})[s||"pending"]||"warning",$=()=>{S.go(-1)},Z=async()=>{await b()},ee=()=>{S.push(`/requisitions/${h.value}/edit`)},te=async()=>{try{await he.confirm("提交後將無法修改，確定要提交審核嗎？","提交確認",{confirmButtonText:"確定提交",cancelButtonText:"取消",type:"warning"}),await R.submitRequisition(h.value),M.success("請購單已提交審核"),await b()}catch(s){s!=="cancel"&&console.error("Submit failed:",s)}},ae=()=>{g.value=!0},N=()=>{g.value=!1},se=()=>{N(),b(),M.success("請購單審核完成")},b=async()=>{try{T.value=!0,await R.fetchRequisitionDetail(h.value)}catch{M.error("獲取請購單詳情失敗"),S.push("/requisitions")}finally{T.value=!1}};return _e(()=>{b()}),(s,r)=>{var U,W;const E=be,oe=Ee,d=we,m=ke,re=qe,C=me,w=Se,le=Re,u=Te,ne=De,ie=fe;return l(),v("div",Ae,[a(_(xe),{title:"請購單詳情",subtitle:h.value,badge:(U=e.value)==null?void 0:U.order_status,"badge-type":X((W=e.value)==null?void 0:W.order_status),"show-back":!0,"show-refresh":!0,onBack:$,onRefresh:Z},{extra:t(()=>[k("div",Ve,[O.value?(l(),p(E,{key:0,type:"primary",icon:_(ve),onClick:ee},{default:t(()=>[...r[1]||(r[1]=[n(" 編輯 ",-1)])]),_:1},8,["icon"])):c("",!0),J.value?(l(),p(E,{key:1,type:"success",icon:_(ye),onClick:te},{default:t(()=>[...r[2]||(r[2]=[n(" 提交審核 ",-1)])]),_:1},8,["icon"])):c("",!0),Q.value?(l(),p(E,{key:2,type:"warning",icon:_(ge),onClick:ae},{default:t(()=>[...r[3]||(r[3]=[n(" 審核 ",-1)])]),_:1},8,["icon"])):c("",!0)])]),_:1},8,["subtitle","badge","badge-type"]),T.value?(l(),v("div",ze,[a(oe,{rows:8,animated:""})])):e.value?(l(),v("div",je,[a(C,{class:"info-card"},{header:t(()=>[...r[4]||(r[4]=[k("h3",null,"基本信息",-1)])]),default:t(()=>[a(re,{column:2,border:""},{default:t(()=>[a(d,{label:"請購單號"},{default:t(()=>[n(i(e.value.request_order_no),1)]),_:1}),a(d,{label:"申請人"},{default:t(()=>[n(i(e.value.requester_name),1)]),_:1}),a(d,{label:"用途類型"},{default:t(()=>[a(m,{type:e.value.usage_type==="project"?"warning":"info"},{default:t(()=>[n(i(e.value.usage_type==="daily"?"日常用品":"專案用品"),1)]),_:1},8,["type"])]),_:1}),e.value.project_id?(l(),p(d,{key:0,label:"專案編號"},{default:t(()=>[n(i(e.value.project_id),1)]),_:1})):c("",!0),a(d,{label:"請購狀態"},{default:t(()=>[a(_(G),{status:e.value.order_status},null,8,["status"])]),_:1}),a(d,{label:"提交日期"},{default:t(()=>[n(i(D(e.value.submit_date)),1)]),_:1}),e.value.order_status==="reviewed"||e.value.order_status==="approved"?(l(),p(d,{key:1,label:"採購狀態"},{default:t(()=>[a(m,{type:A(e.value.purchase_status)},{default:t(()=>[n(i(P(e.value.purchase_status)),1)]),_:1},8,["type"])]),_:1})):c("",!0),e.value.purchase_status==="arrived"?(l(),p(d,{key:2,label:"入庫狀態"},{default:t(()=>[a(m,{type:z(e.value.storage_status)},{default:t(()=>[n(i(V(e.value.storage_status)),1)]),_:1},8,["type"])]),_:1})):c("",!0),e.value.purchase_status==="arrived"?(l(),p(d,{key:3,label:"驗收狀態"},{default:t(()=>[a(m,{type:I(e.value.acceptance_status)},{default:t(()=>[n(i(j(e.value.acceptance_status)),1)]),_:1},8,["type"])]),_:1})):c("",!0),a(d,{label:"創建時間"},{default:t(()=>[n(i(D(e.value.created_at)),1)]),_:1}),a(d,{label:"更新時間"},{default:t(()=>[n(i(D(e.value.updated_at)),1)]),_:1})]),_:1})]),_:1}),e.value.summary?(l(),p(C,{key:0,class:"summary-card"},{header:t(()=>[...r[5]||(r[5]=[k("h3",null,"項目統計",-1)])]),default:t(()=>[a(le,{gutter:20},{default:t(()=>[a(w,{span:6},{default:t(()=>[a(_(q),{title:"總項目數",value:e.value.summary.total_items||0,icon:"DocumentCopy",color:"primary"},null,8,["value"])]),_:1}),a(w,{span:6},{default:t(()=>[a(_(q),{title:"已核准",value:e.value.summary.approved_items||0,icon:"Check",color:"success"},null,8,["value"])]),_:1}),a(w,{span:6},{default:t(()=>[a(_(q),{title:"已駁回",value:e.value.summary.rejected_items||0,icon:"Close",color:"danger"},null,8,["value"])]),_:1}),a(w,{span:6},{default:t(()=>[a(_(q),{title:"有疑問",value:e.value.summary.questioned_items||0,icon:"QuestionFilled",color:"warning"},null,8,["value"])]),_:1})]),_:1})]),_:1})):c("",!0),a(C,{class:"items-card"},{header:t(()=>[...r[6]||(r[6]=[k("h3",null,"請購項目",-1)])]),default:t(()=>[a(ne,{data:L.value,border:"",stripe:""},{default:t(()=>[a(u,{type:"index",label:"序號",width:"60",align:"center"}),a(u,{label:"項目名稱",prop:"item_name","min-width":"150","show-overflow-tooltip":""}),a(u,{label:"規格說明",prop:"item_specification","min-width":"150","show-overflow-tooltip":""}),a(u,{label:"數量",prop:"item_quantity",width:"80",align:"center"}),a(u,{label:"單位",prop:"item_unit",width:"80",align:"center"}),a(u,{label:"類別",prop:"item_category",width:"100",align:"center"},{default:t(({row:o})=>[n(i(Y(o.item_category)),1)]),_:1}),a(u,{label:"請購狀態",prop:"item_status",width:"100",align:"center"},{default:t(({row:o})=>[a(_(G),{status:o.item_status,size:"small"},null,8,["status"])]),_:1}),e.value.order_status==="reviewed"||e.value.order_status==="approved"?(l(),p(u,{key:0,label:"採購狀態",width:"100",align:"center"},{default:t(({row:o})=>[a(m,{type:A(o.purchase_status),size:"small"},{default:t(()=>[n(i(P(o.purchase_status)),1)]),_:2},1032,["type"])]),_:1})):c("",!0),x.value?(l(),p(u,{key:1,label:"入庫狀態",width:"100",align:"center"},{default:t(({row:o})=>[a(m,{type:z(o.storage_status),size:"small"},{default:t(()=>[n(i(V(o.storage_status)),1)]),_:2},1032,["type"])]),_:1})):c("",!0),x.value?(l(),p(u,{key:2,label:"驗收狀態",width:"100",align:"center"},{default:t(({row:o})=>[a(m,{type:I(o.acceptance_status),size:"small"},{default:t(()=>[n(i(j(o.acceptance_status)),1)]),_:2},1032,["type"])]),_:1})):c("",!0),a(u,{label:"供應商",prop:"supplier",width:"120","show-overflow-tooltip":""},{default:t(({row:o})=>{var F;return[n(i(((F=o.supplier)==null?void 0:F.supplier_name_zh)||"-"),1)]}),_:1}),a(u,{label:"單價",prop:"unit_price",width:"100",align:"right"},{default:t(({row:o})=>[o.unit_price?(l(),v("span",Ie,i(B(o.unit_price)),1)):(l(),v("span",Ne,"-"))]),_:1}),a(u,{label:"小計",prop:"subtotal",width:"100",align:"right"},{default:t(({row:o})=>[o.subtotal?(l(),v("span",Ue,i(B(o.subtotal)),1)):(l(),v("span",We,"-"))]),_:1}),a(u,{label:"備註",prop:"status_note","min-width":"150","show-overflow-tooltip":""})]),_:1},8,["data"])]),_:1})])):c("",!0),a(ie,{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=o=>g.value=o),title:"審核請購單",width:"95vw",style:{"max-width":"1400px"},"destroy-on-close":""},{default:t(()=>[e.value?(l(),p(Be,{key:0,requisition:e.value,onClose:N,onUpdated:se},null,8,["requisition"])):c("",!0)]),_:1},8,["modelValue"])])}}});const qt=Ce(Fe,[["__scopeId","data-v-a410d41e"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/requisitions/Detail.vue"]]);export{qt as default};
//# sourceMappingURL=Detail-1a3b0cf6.js.map
