import{d as ce,u as ve,p as pe,r as n,a as B,a1 as me,c as i,b as e,t as o,ab as b,i as Q,aP as c,bw as p,f as H,bx as T,F as W,s as G,aq as V,by as be,bz as _,o as r,ac as J,_ as _e}from"./index-61294aba.js";const fe={class:"users-management"},ye={class:"page-header"},ge={class:"header-left"},we={key:0,class:"stats-cards"},ke={class:"stat-card"},he={class:"stat-number"},Ce={class:"stat-card"},Ue={class:"stat-number"},Ve={class:"stat-card"},xe={class:"stat-number"},je={class:"search-panel"},Me={class:"search-row"},Pe={class:"search-field"},qe={class:"filter-group"},Se=["value"],De={class:"data-table-container"},Fe={class:"data-table"},$e={class:"action-buttons"},ze=["onClick"],Re=["onClick"],Ae=["onClick","disabled"],Ee=["onClick"],Ke={key:0,class:"loading-spinner"},Le={key:1,class:"no-data"},Ne={key:0,class:"pagination"},Be=["disabled"],Te={class:"pagination-info"},We=["disabled"],Ge={class:"modal-header"},Ie={class:"form-row"},Oe={class:"form-field"},Qe=["disabled"],He={class:"form-field"},Je={class:"form-row"},Xe={class:"form-field"},Ye={class:"form-field"},Ze={class:"form-row"},es={class:"form-field"},ss=["value"],ts={class:"form-field"},ls={key:0,class:"form-row"},as={class:"form-field"},os={class:"form-field"},ns={class:"form-actions"},is=["disabled"],rs={class:"modal-header"},ds={class:"form-field"},us={class:"form-field"},cs={class:"form-actions"},vs=["disabled"],ps={class:"confirm-content"},ms=ce({__name:"Users",setup(bs){const X=ve(),Y=pe(()=>X.currentUser),R=n([]),x=n([]),w=n(null),j=n(!1),M=n(!1),P=n(!1),q=n(""),u=B({q:"",role:void 0,department:"",is_active:void 0,page:1,page_size:20}),v=B({page:1,page_size:20,total:0,pages:0}),S=n(!1),A=n(!1),E=n(!1),m=n(null),k=n(null),l=B({username:"",chinese_name:"",password:"",department:"",job_title:"",role:"Everyone",is_active:!0}),h=n(""),y=n(""),C=n(""),K=n(""),D=n(null),f=async()=>{j.value=!0;try{const a=await _.searchUsers(u);R.value=a.items,v.page=a.pagination.page,v.page_size=a.pagination.page_size,v.total=a.pagination.total,v.pages=a.pagination.pages}catch(a){console.error("Failed to load users:",a)}finally{j.value=!1}},Z=async()=>{try{x.value=await _.getRoles()}catch(a){console.error("Failed to load roles:",a)}},F=async()=>{try{w.value=await _.getUserStatistics()}catch(a){console.error("Failed to load statistics:",a)}},U=()=>{u.q=q.value,u.page=1,f()},ee=()=>{q.value="",u.q="",u.role=void 0,u.department="",u.is_active=void 0,u.page=1,f()},I=a=>{u.page=a,f()},se=()=>{m.value=null,O(),S.value=!0},te=a=>{m.value=a,l.username=a.username,l.chinese_name=a.chinese_name,l.department=a.department||"",l.job_title=a.job_title||"",l.role=a.role,l.is_active=a.is_active,l.password="",h.value="",S.value=!0},$=()=>{S.value=!1,m.value=null,O()},O=()=>{l.username="",l.chinese_name="",l.password="",l.department="",l.job_title="",l.role="Everyone",l.is_active=!0,h.value=""},le=async()=>{var a,s,d;if(!m.value&&l.password!==h.value){alert("密碼確認不符");return}M.value=!0;try{if(m.value){const t={chinese_name:l.chinese_name,department:l.department,job_title:l.job_title,role:l.role,is_active:l.is_active};await _.updateUser(m.value.user_id,t)}else{const t={username:l.username,chinese_name:l.chinese_name,password:l.password,department:l.department,job_title:l.job_title,role:l.role,is_active:l.is_active};await _.createUser(t)}$(),f(),F()}catch(t){alert(((d=(s=(a=t.response)==null?void 0:a.data)==null?void 0:s.error)==null?void 0:d.message)||"保存失败")}finally{M.value=!1}},ae=a=>{k.value=a,y.value="",C.value="",A.value=!0},z=()=>{A.value=!1,k.value=null,y.value="",C.value=""},oe=async()=>{var a,s,d;if(y.value!==C.value){alert("密碼確認不符");return}if(k.value){P.value=!0;try{await _.resetUserPassword(k.value.user_id,{new_password:y.value}),z(),alert("密碼重置成功")}catch(t){alert(((d=(s=(a=t.response)==null?void 0:a.data)==null?void 0:s.error)==null?void 0:d.message)||"密碼重置失败")}finally{P.value=!1}}},ne=a=>{K.value=`確定要停用用戶 "${a.chinese_name}" 嗎？`,D.value=async()=>{var s,d,t;try{await _.deleteUser(a.user_id),f(),F()}catch(g){alert(((t=(d=(s=g.response)==null?void 0:s.data)==null?void 0:d.error)==null?void 0:t.message)||"停用失败")}},E.value=!0},ie=async a=>{var s,d,t;try{await _.activateUser(a.user_id),f(),F()}catch(g){alert(((t=(d=(s=g.response)==null?void 0:s.data)==null?void 0:d.error)==null?void 0:t.message)||"啟用失败")}},re=()=>{D.value&&D.value(),L()},L=()=>{E.value=!1,D.value=null,K.value=""},de=a=>{const s=x.value.find(d=>d.value===a);return(s==null?void 0:s.label)||a},ue=a=>a?new Date(a).toLocaleString("zh-TW"):"-";return me(()=>{f(),Z(),F()}),(a,s)=>{var d;return r(),i("div",fe,[e("div",ye,[e("div",ge,[s[22]||(s[22]=e("h1",{class:"page-title"},"用戶管理",-1)),w.value?(r(),i("div",we,[e("div",ke,[e("div",he,o(w.value.total_users),1),s[19]||(s[19]=e("div",{class:"stat-label"},"總用戶數",-1))]),e("div",Ce,[e("div",Ue,o(w.value.active_users),1),s[20]||(s[20]=e("div",{class:"stat-label"},"活躍用戶",-1))]),e("div",Ve,[e("div",xe,o(w.value.inactive_users),1),s[21]||(s[21]=e("div",{class:"stat-label"},"停用用戶",-1))])])):b("",!0)]),e("div",{class:"header-actions"},[e("button",{class:"btn btn-primary",onClick:se},[...s[23]||(s[23]=[e("i",{class:"icon-plus"},null,-1),Q(" 新增用戶 ",-1)])])])]),e("div",je,[e("div",Me,[e("div",Pe,[c(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>q.value=t),type:"text",placeholder:"搜尋用戶名稱、姓名、部門...",class:"search-input",onKeyup:H(U,["enter"])},null,544),[[p,q.value]]),e("button",{class:"search-btn",onClick:U},[...s[24]||(s[24]=[e("i",{class:"icon-search"},null,-1)])])]),e("div",qe,[c(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>u.role=t),class:"filter-select",onChange:U},[s[25]||(s[25]=e("option",{value:""},"全部角色",-1)),(r(!0),i(W,null,G(x.value,t=>(r(),i("option",{key:t.value,value:t.value},o(t.label),9,Se))),128))],544),[[T,u.role]]),c(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>u.is_active=t),class:"filter-select",onChange:U},[...s[26]||(s[26]=[e("option",{value:""},"全部狀態",-1),e("option",{value:"true"},"活躍",-1),e("option",{value:"false"},"停用",-1)])],544),[[T,u.is_active]]),c(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>u.department=t),type:"text",placeholder:"部門",class:"filter-input",onKeyup:H(U,["enter"])},null,544),[[p,u.department]]),e("button",{class:"btn btn-outline",onClick:ee},"清除篩選")])])]),e("div",De,[e("table",Fe,[s[31]||(s[31]=e("thead",null,[e("tr",null,[e("th",null,"用戶ID"),e("th",null,"中文姓名"),e("th",null,"用戶名稱"),e("th",null,"部門"),e("th",null,"職稱"),e("th",null,"角色"),e("th",null,"狀態"),e("th",null,"創建時間"),e("th",null,"操作")])],-1)),e("tbody",null,[(r(!0),i(W,null,G(R.value,t=>{var g;return r(),i("tr",{key:t.user_id,class:"table-row"},[e("td",null,o(t.user_id),1),e("td",null,o(t.chinese_name),1),e("td",null,o(t.username),1),e("td",null,o(t.department||"-"),1),e("td",null,o(t.job_title||"-"),1),e("td",null,[e("span",{class:J(["role-badge",`role-${t.role.toLowerCase()}`])},o(de(t.role)),3)]),e("td",null,[e("span",{class:J(["status-badge",t.is_active?"status-active":"status-inactive"])},o(t.is_active?"活躍":"停用"),3)]),e("td",null,o(ue(t.created_at)),1),e("td",null,[e("div",$e,[e("button",{class:"btn-icon",onClick:N=>te(t),title:"編輯"},[...s[27]||(s[27]=[e("i",{class:"icon-edit"},null,-1)])],8,ze),e("button",{class:"btn-icon",onClick:N=>ae(t),title:"重置密碼"},[...s[28]||(s[28]=[e("i",{class:"icon-key"},null,-1)])],8,Re),t.is_active?(r(),i("button",{key:0,class:"btn-icon btn-danger",onClick:N=>ne(t),title:"停用",disabled:t.user_id===((g=Y.value)==null?void 0:g.user_id)},[...s[29]||(s[29]=[e("i",{class:"icon-ban"},null,-1)])],8,Ae)):(r(),i("button",{key:1,class:"btn-icon btn-success",onClick:N=>ie(t),title:"啟用"},[...s[30]||(s[30]=[e("i",{class:"icon-check"},null,-1)])],8,Ee))])])])}),128))])]),j.value?(r(),i("div",Ke,"載入中...")):b("",!0),!j.value&&R.value.length===0?(r(),i("div",Le,"沒有找到用戶")):b("",!0)]),v.pages>1?(r(),i("div",Ne,[e("button",{class:"pagination-btn",disabled:v.page<=1,onClick:s[4]||(s[4]=t=>I(v.page-1))}," 上一頁 ",8,Be),e("span",Te," 第 "+o(v.page)+" 頁，共 "+o(v.pages)+" 頁 (總計 "+o(v.total)+" 筆) ",1),e("button",{class:"pagination-btn",disabled:v.page>=v.pages,onClick:s[5]||(s[5]=t=>I(v.page+1))}," 下一頁 ",8,We)])):b("",!0),S.value?(r(),i("div",{key:1,class:"modal-overlay",onClick:$},[e("div",{class:"modal-content",onClick:s[14]||(s[14]=V(()=>{},["stop"]))},[e("div",Ge,[e("h3",null,o(m.value?"編輯用戶":"新增用戶"),1),e("button",{class:"close-btn",onClick:$},"×")]),e("form",{onSubmit:V(le,["prevent"]),class:"user-form"},[e("div",Ie,[e("div",Oe,[s[32]||(s[32]=e("label",null,"用戶名稱 *",-1)),c(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.username=t),type:"text",required:"",disabled:!!m.value,class:"form-input"},null,8,Qe),[[p,l.username]])]),e("div",He,[s[33]||(s[33]=e("label",null,"中文姓名 *",-1)),c(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>l.chinese_name=t),type:"text",required:"",class:"form-input"},null,512),[[p,l.chinese_name]])])]),e("div",Je,[e("div",Xe,[s[34]||(s[34]=e("label",null,"部門",-1)),c(e("input",{"onUpdate:modelValue":s[8]||(s[8]=t=>l.department=t),type:"text",class:"form-input"},null,512),[[p,l.department]])]),e("div",Ye,[s[35]||(s[35]=e("label",null,"職稱",-1)),c(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>l.job_title=t),type:"text",class:"form-input"},null,512),[[p,l.job_title]])])]),e("div",Ze,[e("div",es,[s[37]||(s[37]=e("label",null,"角色 *",-1)),c(e("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.role=t),required:"",class:"form-select"},[s[36]||(s[36]=e("option",{value:""},"請選擇角色",-1)),(r(!0),i(W,null,G(x.value,t=>(r(),i("option",{key:t.value,value:t.value},o(t.label),9,ss))),128))],512),[[T,l.role]])]),e("div",ts,[e("label",null,[c(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>l.is_active=t),type:"checkbox",class:"form-checkbox"},null,512),[[be,l.is_active]]),s[38]||(s[38]=Q(" 啟用帳號 ",-1))])])]),m.value?b("",!0):(r(),i("div",ls,[e("div",as,[s[39]||(s[39]=e("label",null,"密碼 *",-1)),c(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>l.password=t),type:"password",required:"",class:"form-input",placeholder:"至少8字符，包含大小寫字母、數字和特殊字符"},null,512),[[p,l.password]])]),e("div",os,[s[40]||(s[40]=e("label",null,"確認密碼 *",-1)),c(e("input",{"onUpdate:modelValue":s[13]||(s[13]=t=>h.value=t),type:"password",required:"",class:"form-input"},null,512),[[p,h.value]])])])),e("div",ns,[e("button",{type:"button",class:"btn btn-outline",onClick:$},"取消"),e("button",{type:"submit",class:"btn btn-primary",disabled:M.value},o(M.value?"儲存中...":"儲存"),9,is)])],32)])])):b("",!0),A.value?(r(),i("div",{key:2,class:"modal-overlay",onClick:z},[e("div",{class:"modal-content",onClick:s[17]||(s[17]=V(()=>{},["stop"]))},[e("div",rs,[e("h3",null,"重置密碼 - "+o((d=k.value)==null?void 0:d.chinese_name),1),e("button",{class:"close-btn",onClick:z},"×")]),e("form",{onSubmit:V(oe,["prevent"]),class:"password-form"},[e("div",ds,[s[41]||(s[41]=e("label",null,"新密碼 *",-1)),c(e("input",{"onUpdate:modelValue":s[15]||(s[15]=t=>y.value=t),type:"password",required:"",class:"form-input",placeholder:"至少8字符，包含大小寫字母、數字和特殊字符"},null,512),[[p,y.value]])]),e("div",us,[s[42]||(s[42]=e("label",null,"確認新密碼 *",-1)),c(e("input",{"onUpdate:modelValue":s[16]||(s[16]=t=>C.value=t),type:"password",required:"",class:"form-input"},null,512),[[p,C.value]])]),e("div",cs,[e("button",{type:"button",class:"btn btn-outline",onClick:z},"取消"),e("button",{type:"submit",class:"btn btn-primary",disabled:P.value},o(P.value?"重置中...":"重置密碼"),9,vs)])],32)])])):b("",!0),E.value?(r(),i("div",{key:3,class:"modal-overlay",onClick:L},[e("div",{class:"modal-content confirm-dialog",onClick:s[18]||(s[18]=V(()=>{},["stop"]))},[s[43]||(s[43]=e("div",{class:"modal-header"},[e("h3",null,"確認操作")],-1)),e("div",ps,[e("p",null,o(K.value),1)]),e("div",{class:"form-actions"},[e("button",{class:"btn btn-outline",onClick:L},"取消"),e("button",{class:"btn btn-danger",onClick:re},"確認")])])])):b("",!0)])}}});const fs=_e(ms,[["__scopeId","data-v-9cc42bc2"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/system/Users.vue"]]);export{fs as default};
//# sourceMappingURL=Users-db3dd4f5.js.map
