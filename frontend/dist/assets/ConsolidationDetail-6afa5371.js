import{d as q,n as Q,y as Z,r as E,a as ee,a1 as te,c as _,b as d,e,w as a,X as k,b1 as ae,al as le,T as oe,o as p,i as s,t as i,F as B,ao as se,v as ne,x as re,aJ as ie,m as ue,j as de,aK as _e,av as pe,aw as ce,ah as me,ai as ve,k as fe,au as be,E as ke,aL as ye,_ as ge}from"./index-61294aba.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                             *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                *//* empty css                             *//* empty css                         *//* empty css                   *//* empty css                           */import{a as we,d as N}from"./delivery-337552f6.js";const De={class:"consolidation-detail"},Ee={class:"page-header"},Ve={class:"header-content"},xe={key:0,class:"loading-container"},Ce={key:1,class:"detail-content"},he={class:"remarks-section"},Se={style:{"margin-top":"10px"}},Me={class:"action-buttons"},Re={key:0},Be={key:1},Ne={key:2},Te=q({__name:"ConsolidationDetail",setup(Ue){const T=Q(),V=Z(),x=E(!1),l=E({}),w=E(!1),f=E(""),o=ee({visible:!1,newStatus:"",carrier:"",trackingNumber:"",expectedDeliveryDate:"",remarks:""}),M=async()=>{x.value=!0;try{const n=T.params.id,t=await we();if(t.success&&t.data){const c=t.data.find(b=>b.consolidation_id===n);c?l.value=c:(k.error("集運單不存在"),V.push("/purchase-orders/delivery"))}}catch(n){console.error("載入集運單詳情失敗:",n),k.error("載入集運單詳情失敗")}finally{x.value=!1}},U=()=>l.value.pos_in_consolidation?l.value.pos_in_consolidation.reduce((n,t)=>n+(t.items_count||t.item_count||0),0):0,C=n=>n?new Date(n).toLocaleDateString("zh-TW"):"-",h=n=>({shipped:"info",in_transit:"warning",foreign_customs:"warning",taiwan_customs:"warning",delivered:"success"})[n]||"info",S=n=>({shipped:"已發貨",in_transit:"物流中",foreign_customs:"對方海關",taiwan_customs:"台灣海關",delivered:"已到貨"})[n]||n,Y=()=>{f.value=l.value.remarks||"",w.value=!0},I=()=>{w.value=!1,f.value=""},z=async()=>{try{await N(l.value.consolidation_id,{new_status:l.value.logistics_status,remarks:f.value}),l.value.remarks=f.value,w.value=!1,k.success("備註更新成功")}catch(n){console.error("更新備註失敗:",n),k.error("更新備註失敗")}},P=()=>{o.newStatus=l.value.logistics_status||"",o.carrier=l.value.carrier||"",o.trackingNumber=l.value.tracking_number||"",o.expectedDeliveryDate=l.value.expected_delivery_date||"",o.remarks=l.value.remarks||"",o.visible=!0},F=async()=>{try{await N(l.value.consolidation_id,{new_status:o.newStatus,carrier:o.carrier,tracking_number:o.trackingNumber,expected_date:o.expectedDeliveryDate,remarks:o.remarks}),k.success("狀態更新成功"),o.visible=!1,await M()}catch(n){console.error("更新狀態失敗:",n),k.error("更新狀態失敗")}},L=n=>{V.push(`/purchase-orders/${n}`)},O=()=>{V.push("/purchase-orders/delivery?tab=consolidation")};return te(()=>{M()}),(n,t)=>{const c=se,b=ne,$=re,j=ae,A=ye,u=ie,m=ue,D=de,H=_e,R=le,v=pe,K=ce,y=me,W=ve,g=fe,G=be,J=ke,X=oe;return p(),_("div",De,[d("div",Ee,[e(j,{onBack:O},{content:a(()=>[d("div",Ve,[t[8]||(t[8]=d("h2",null,"集運單詳情",-1)),e(c,{type:h(l.value.logistics_status),size:"large"},{default:a(()=>[s(i(S(l.value.logistics_status)),1)]),_:1},8,["type"])])]),breadcrumb:a(()=>[e($,{separator:"/"},{default:a(()=>[e(b,{to:{path:"/"}},{default:a(()=>[...t[9]||(t[9]=[s("首頁",-1)])]),_:1}),e(b,{to:{path:"/purchase-orders"}},{default:a(()=>[...t[10]||(t[10]=[s("採購管理",-1)])]),_:1}),e(b,{to:{path:"/purchase-orders/delivery"}},{default:a(()=>[...t[11]||(t[11]=[s("交期維護",-1)])]),_:1}),e(b,null,{default:a(()=>[...t[12]||(t[12]=[s("集運單詳情",-1)])]),_:1})]),_:1})]),_:1})]),x.value?(p(),_("div",xe,[e(A,{rows:8,animated:""})])):(p(),_("div",Ce,[e(R,{class:"info-card"},{header:a(()=>[...t[13]||(t[13]=[d("h3",null,"集運單信息",-1)])]),default:a(()=>[e(H,{column:3,border:""},{default:a(()=>[e(u,{label:"集運單號"},{default:a(()=>[s(i(l.value.consolidation_id),1)]),_:1}),e(u,{label:"集運單名稱"},{default:a(()=>[s(i(l.value.consolidation_name||"-"),1)]),_:1}),e(u,{label:"物流狀態"},{default:a(()=>[e(c,{type:h(l.value.logistics_status)},{default:a(()=>[s(i(S(l.value.logistics_status)),1)]),_:1},8,["type"])]),_:1}),e(u,{label:"物流廠商"},{default:a(()=>[s(i(l.value.carrier||"-"),1)]),_:1}),e(u,{label:"物流號碼"},{default:a(()=>[s(i(l.value.tracking_number||"-"),1)]),_:1}),e(u,{label:"預計到貨日"},{default:a(()=>[s(i(C(l.value.expected_delivery_date)),1)]),_:1}),e(u,{label:"實際到貨日"},{default:a(()=>[s(i(C(l.value.actual_delivery_date)),1)]),_:1}),e(u,{label:"採購單數量"},{default:a(()=>[s(i(l.value.pos_count||0),1)]),_:1}),e(u,{label:"總物品數量"},{default:a(()=>[s(i(U()),1)]),_:1}),e(u,{label:"備註",span:3},{default:a(()=>[d("div",he,[w.value?(p(),_(B,{key:1},[e(D,{modelValue:f.value,"onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),type:"textarea",rows:2,style:{width:"100%"}},null,8,["modelValue"]),d("div",Se,[e(m,{size:"small",onClick:I},{default:a(()=>[...t[15]||(t[15]=[s("取消",-1)])]),_:1}),e(m,{size:"small",type:"primary",onClick:z},{default:a(()=>[...t[16]||(t[16]=[s("保存",-1)])]),_:1})])],64)):(p(),_(B,{key:0},[d("span",null,i(l.value.remarks||"-"),1),e(m,{type:"primary",link:"",size:"small",onClick:Y,style:{"margin-left":"10px"}},{default:a(()=>[...t[14]||(t[14]=[s(" 編輯 ",-1)])]),_:1})],64))])]),_:1})]),_:1}),d("div",Me,[e(m,{type:"primary",onClick:P},{default:a(()=>[...t[17]||(t[17]=[s("更新狀態",-1)])]),_:1})])]),_:1}),e(R,{class:"po-list-card"},{header:a(()=>[...t[18]||(t[18]=[d("h3",null,"包含的採購單",-1)])]),default:a(()=>[e(K,{data:l.value.pos_in_consolidation,stripe:""},{default:a(()=>[e(v,{prop:"purchase_order_no",label:"採購單號",width:"150"}),e(v,{prop:"supplier_name",label:"供應商",width:"200"}),e(v,{label:"交貨狀態",width:"100"},{default:a(()=>[e(c,{type:"info"},{default:a(()=>[s(i(l.value.logistics_status==="delivered"?"已到貨":"未到貨"),1)]),_:1})]),_:1}),e(v,{label:"物流狀態",width:"120"},{default:a(()=>[e(c,{type:h(l.value.logistics_status)},{default:a(()=>[s(i(S(l.value.logistics_status)),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"預計交貨日"},{default:a(()=>[s(i(C(l.value.expected_delivery_date)),1)]),_:1}),e(v,{label:"備註/追蹤號"},{default:a(()=>[l.value.tracking_number?(p(),_("span",Re,i(l.value.tracking_number),1)):l.value.remarks?(p(),_("span",Be,i(l.value.remarks),1)):(p(),_("span",Ne,"-"))]),_:1}),e(v,{label:"操作",width:"100"},{default:a(({row:r})=>[e(m,{type:"primary",link:"",size:"small",onClick:Ye=>L(r.purchase_order_no)},{default:a(()=>[...t[19]||(t[19]=[s(" 查看詳情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})])),e(X,{modelValue:o.visible,"onUpdate:modelValue":t[7]||(t[7]=r=>o.visible=r),title:"更新集運單狀態",width:"600px"},{footer:a(()=>[e(m,{onClick:t[6]||(t[6]=r=>o.visible=!1)},{default:a(()=>[...t[20]||(t[20]=[s("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:F},{default:a(()=>[...t[21]||(t[21]=[s("確認更新",-1)])]),_:1})]),default:a(()=>[e(J,{model:o,"label-width":"120px"},{default:a(()=>[e(g,{label:"物流狀態"},{default:a(()=>[e(W,{modelValue:o.newStatus,"onUpdate:modelValue":t[1]||(t[1]=r=>o.newStatus=r),placeholder:"選擇新狀態"},{default:a(()=>[e(y,{label:"已發貨",value:"shipped"}),e(y,{label:"物流中",value:"in_transit"}),e(y,{label:"對方海關",value:"foreign_customs"}),e(y,{label:"台灣海關",value:"taiwan_customs"}),e(y,{label:"已到貨",value:"delivered"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"物流廠商"},{default:a(()=>[e(D,{modelValue:o.carrier,"onUpdate:modelValue":t[2]||(t[2]=r=>o.carrier=r),placeholder:"輸入物流廠商名稱"},null,8,["modelValue"])]),_:1}),e(g,{label:"物流號碼"},{default:a(()=>[e(D,{modelValue:o.trackingNumber,"onUpdate:modelValue":t[3]||(t[3]=r=>o.trackingNumber=r),placeholder:"輸入物流追蹤號碼"},null,8,["modelValue"])]),_:1}),e(g,{label:"預計到貨日期"},{default:a(()=>[e(G,{modelValue:o.expectedDeliveryDate,"onUpdate:modelValue":t[4]||(t[4]=r=>o.expectedDeliveryDate=r),type:"date",placeholder:"選擇預計到貨日期",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(g,{label:"備註"},{default:a(()=>[e(D,{modelValue:o.remarks,"onUpdate:modelValue":t[5]||(t[5]=r=>o.remarks=r),type:"textarea",rows:3,placeholder:"輸入備註"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const et=ge(Te,[["__scopeId","data-v-5923d1ed"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/purchase-orders/ConsolidationDetail.vue"]]);export{et as default};
//# sourceMappingURL=ConsolidationDetail-6afa5371.js.map
