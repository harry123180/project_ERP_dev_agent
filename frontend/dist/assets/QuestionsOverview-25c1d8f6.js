import{d as H,r as _,p as J,a1 as Y,c as v,b as n,e as t,w as s,X as y,m as Z,a4 as ee,j as te,aw as se,T as ae,o as c,g as f,ap as le,i as d,aB as oe,h as ie,aT as ne,a5 as ue,ag as de,a9 as re,t as p,q as B,ab as U,b4 as _e,a3 as D,I as ce,b3 as pe,al as me,aj as ve,av as fe,ao as ye,aO as ge,_ as be}from"./index-61294aba.js";/* empty css                 *//* empty css                  *//* empty css                   *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                 *//* empty css               *//* empty css                *//* empty css                     *//* empty css                  */const we={class:"questions-overview"},he={class:"page-header"},Ce={class:"header-actions"},ke={class:"statistics-container"},je={class:"statistic-icon users"},qe={class:"statistic-icon requisitions"},Ee={class:"statistic-icon questioned"},$e={class:"statistic-icon rejected"},Ve={class:"table-container"},xe={class:"table-header"},Le={key:1},Te={key:1},Ue={key:0,class:"status-good"},ze={key:1,class:"status-summary"},Ie={key:0},Ne={key:0},Qe={key:1},Se={class:"line-message-preview"},Be={style:{"margin-top":"10px"}},De={class:"info-notice"},Oe=H({__name:"QuestionsOverview",setup(Me){const x=_(!1),C=_(!1),k=_([]),j=_([]),q=_(!1),b=_(!1),z=_({}),r=_(null),w=_(""),h=_(""),g=_({total_users:0,total_items:0,total_questioned:0,total_rejected:0}),O=J(()=>h.value?k.value.filter(o=>o.display_name.toLowerCase().includes(h.value.toLowerCase())||o.username.toLowerCase().includes(h.value.toLowerCase())):k.value),M=async()=>{var o;x.value=!0;try{const e=await D.get("/requisitions/user-statistics"),a=((o=e.data)==null?void 0:o.data)||e.data||{};k.value=a.user_statistics||[],g.value=a.summary||{total_users:0,total_items:0,total_questioned:0,total_rejected:0}}catch(e){console.error("載入用戶統計失敗:",e),y.error("載入用戶統計失敗")}finally{x.value=!1}},A=async()=>{var o;try{const e=await D.get("/requisitions/questions-data"),a=((o=e.data)==null?void 0:o.data)||e.data||{};j.value=a.user_questions||[]}catch(e){console.error("載入疑問資料失敗:",e),y.error("載入疑問資料失敗")}},I=async()=>{await Promise.all([M(),A()]),y.success("資料已重新整理")},P=async o=>{z.value=o;const e=j.value.find(a=>a.username===o.username||a.username===o.display_name);r.value=e||{questions:[],rejections:[]},w.value=N(o,r.value),q.value=!0},N=(o,e)=>{let a=`請購項目狀態通知

`;return a+=`${o.display_name}
`,o.questioned_items>0&&(a+=`有疑問項目: ${o.questioned_items} 個
`),o.rejected_items>0&&(a+=`拒絕項目: ${o.rejected_items} 個
`),a+=`
`,e.questions&&e.questions.length>0&&(a+=`疑問項目詳情:
`,e.questions.forEach((i,m)=>{a+=`${m+1}. ${i.item_name||"未知物品"}`,i.status_note?a+=` - ${i.status_note}
`:a+=` - 有疑問
`,a+=`   請購單號: ${i.request_order_no}
`}),a+=`
`),e.rejections&&e.rejections.length>0&&(a+=`拒絕項目詳情:
`,e.rejections.forEach((i,m)=>{a+=`${m+1}. ${i.item_name||"未知物品"}`,i.status_note?a+=` - ${i.status_note}
`:a+=` - 已拒絕
`,a+=`   請購單號: ${i.request_order_no}
`}),a+=`
`),a+=`請盡快處理上述項目問題，如有疑問請聯繫採購部門。
`,a+=`
${new Date().toLocaleString("zh-TW")}`,a},R=async o=>{const e=j.value.find(i=>i.username===o.username||i.username===o.display_name),a=N(o,e||{questions:[],rejections:[]});await L(a)},L=async o=>{try{await navigator.clipboard.writeText(o),y.success("已複製到剪貼簿！可以貼到LINE中發送。")}catch(e){console.error("複製失敗:",e),y.error("複製失敗，請手動複製")}},W=()=>{b.value=!0},G=async()=>{C.value=!0;try{await new Promise(o=>setTimeout(o,1e3)),k.value=[],j.value=[],g.value={total_users:0,total_items:0,total_questioned:0,total_rejected:0},b.value=!1,y.success("所有疑問資料已清除")}catch(o){console.error("清除資料失敗:",o),y.error("清除資料失敗")}finally{C.value=!1}};return Y(()=>{I()}),(o,e)=>{const a=ce,i=Z,m=pe,E=me,$=ve,K=ee,Q=te,u=fe,V=ye,T=se,S=ae,X=ge;return c(),v("div",we,[n("div",he,[e[10]||(e[10]=n("h1",{class:"page-title"},"疑問總覽",-1)),n("div",Ce,[t(i,{type:"primary",onClick:I},{default:s(()=>[t(a,null,{default:s(()=>[t(f(le))]),_:1}),e[8]||(e[8]=d(" 重新整理 ",-1))]),_:1}),t(i,{type:"info",onClick:W,loading:C.value},{default:s(()=>[t(a,null,{default:s(()=>[t(f(oe))]),_:1}),e[9]||(e[9]=d(" 清除所有資料 ",-1))]),_:1},8,["loading"])])]),n("div",ke,[t(K,{gutter:20},{default:s(()=>[t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"總提交用戶",value:g.value.total_users},null,8,["value"]),n("div",je,[t(a,null,{default:s(()=>[t(f(ie))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"總請購項目",value:g.value.total_items},null,8,["value"]),n("div",qe,[t(a,null,{default:s(()=>[t(f(ne))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"有疑問項目",value:g.value.total_questioned},null,8,["value"]),n("div",Ee,[t(a,null,{default:s(()=>[t(f(ue))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"拒絕項目",value:g.value.total_rejected},null,8,["value"]),n("div",$e,[t(a,null,{default:s(()=>[t(f(de))]),_:1})])]),_:1})]),_:1})]),_:1})]),n("div",Ve,[n("div",xe,[e[11]||(e[11]=n("h2",null,"用戶請購統計",-1)),t(Q,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"搜尋用戶...",style:{width:"200px"},clearable:""},{prefix:s(()=>[t(a,null,{default:s(()=>[t(f(re))]),_:1})]),_:1},8,["modelValue"])]),t(T,{data:O.value,loading:x.value,stripe:"",style:{width:"100%"}},{default:s(()=>[t(u,{prop:"display_name",label:"用戶名稱",width:"150"}),t(u,{prop:"total_items",label:"總請購項目",width:"120",align:"center"},{default:s(({row:l})=>[t(V,{type:"info",size:"small"},{default:s(()=>[d(p(l.total_items),1)]),_:2},1024)]),_:1}),t(u,{prop:"questioned_items",label:"有疑問項目",width:"120",align:"center"},{default:s(({row:l})=>[l.questioned_items>0?(c(),B(V,{key:0,type:"warning",size:"small"},{default:s(()=>[d(p(l.questioned_items),1)]),_:2},1024)):(c(),v("span",Le,"0"))]),_:1}),t(u,{prop:"rejected_items",label:"拒絕項目",width:"120",align:"center"},{default:s(({row:l})=>[l.rejected_items>0?(c(),B(V,{key:0,type:"danger",size:"small"},{default:s(()=>[d(p(l.rejected_items),1)]),_:2},1024)):(c(),v("span",Te,"0"))]),_:1}),t(u,{prop:"total_problematic",label:"問題總數",width:"120",align:"center"},{default:s(({row:l})=>[t(V,{type:l.total_problematic>0?"danger":"success",size:"small"},{default:s(()=>[d(p(l.total_problematic),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"狀態摘要","min-width":"200"},{default:s(({row:l})=>[l.total_problematic===0?(c(),v("span",Ue," ✅ 所有請購項目正常 ")):(c(),v("span",ze,p(l.display_name)+" - "+p(l.total_items)+" 個請購項目已提交， "+p(l.questioned_items)+" 個有疑問， "+p(l.rejected_items)+" 個被拒絕 ",1))]),_:1}),t(u,{label:"操作",width:"180",align:"center"},{default:s(({row:l})=>[t(i,{size:"small",type:"primary",onClick:F=>P(l),disabled:l.total_problematic===0},{default:s(()=>[...e[12]||(e[12]=[d(" 查看詳情 ",-1)])]),_:1},8,["onClick","disabled"]),t(i,{size:"small",type:"success",onClick:F=>R(l),disabled:l.total_problematic===0},{default:s(()=>[...e[13]||(e[13]=[d(" 複製LINE訊息 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data","loading"])]),t(S,{modelValue:q.value,"onUpdate:modelValue":e[5]||(e[5]=l=>q.value=l),title:`${z.value.display_name} 的疑問詳情`,width:"900px","close-on-click-modal":!1},{footer:s(()=>[t(i,{onClick:e[3]||(e[3]=l=>q.value=!1)},{default:s(()=>[...e[16]||(e[16]=[d("關閉",-1)])]),_:1}),t(i,{type:"success",onClick:e[4]||(e[4]=l=>L(w.value))},{default:s(()=>[...e[17]||(e[17]=[d(" 複製LINE訊息 ",-1)])]),_:1})]),default:s(()=>[r.value?(c(),v("div",Ie,[r.value.questions&&r.value.questions.length>0?(c(),v("div",Ne,[n("h4",null,"❓ 疑問項目 ("+p(r.value.questions.length)+")",1),t(T,{data:r.value.questions,size:"small",style:{"margin-bottom":"20px"}},{default:s(()=>[t(u,{prop:"request_order_no",label:"請購單號",width:"120"}),t(u,{prop:"item_name",label:"項目名稱",width:"150"}),t(u,{prop:"status_note",label:"疑問內容","min-width":"200"}),t(u,{prop:"submit_date",label:"提交日期",width:"100"})]),_:1},8,["data"])])):U("",!0),r.value.rejections&&r.value.rejections.length>0?(c(),v("div",Qe,[n("h4",null,"❌ 拒絕項目 ("+p(r.value.rejections.length)+")",1),t(T,{data:r.value.rejections,size:"small"},{default:s(()=>[t(u,{prop:"request_order_no",label:"請購單號",width:"120"}),t(u,{prop:"item_name",label:"項目名稱",width:"150"}),t(u,{prop:"status_note",label:"拒絕原因","min-width":"200"}),t(u,{prop:"submit_date",label:"提交日期",width:"100"})]),_:1},8,["data"])])):U("",!0),n("div",Se,[e[15]||(e[15]=n("h4",null,"📱 LINE 訊息預覽",-1)),t(Q,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),type:"textarea",rows:6,readonly:"",class:"line-message-text"},null,8,["modelValue"]),n("div",Be,[t(i,{type:"success",onClick:e[2]||(e[2]=l=>L(w.value))},{default:s(()=>[t(a,null,{default:s(()=>[t(f(_e))]),_:1}),e[14]||(e[14]=d(" 複製到剪貼簿 ",-1))]),_:1})])])])):U("",!0)]),_:1},8,["modelValue","title"]),t(S,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),title:"確認清除資料",width:"400px"},{footer:s(()=>[t(i,{onClick:e[6]||(e[6]=l=>b.value=!1)},{default:s(()=>[...e[18]||(e[18]=[d("取消",-1)])]),_:1}),t(i,{type:"danger",onClick:G,loading:C.value},{default:s(()=>[...e[19]||(e[19]=[d(" 確定清除 ",-1)])]),_:1},8,["loading"])]),default:s(()=>[e[20]||(e[20]=n("p",null,"您確定要清除所有疑問和拒絕資料嗎？此操作無法撤銷。",-1))]),_:1},8,["modelValue"]),n("div",De,[t(X,{title:"功能說明",description:"此頁面顯示所有用戶的請購單統計，包括疑問和拒絕的項目。您可以查看詳情並複製LINE訊息來通知用戶。",type:"info","show-icon":"",closable:!1})])])}}});const tt=be(Oe,[["__scopeId","data-v-9ee8c2ec"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/purchase-orders/QuestionsOverview.vue"]]);export{tt as default};
//# sourceMappingURL=QuestionsOverview-25c1d8f6.js.map
