import{d as H,r as _,p as J,a1 as Y,c as v,b as n,e as t,w as s,X as y,m as Z,a4 as ee,j as te,aw as se,T as ae,o as c,g as f,ap as le,i as d,aB as oe,h as ie,aT as ne,a5 as ue,ag as de,a9 as re,t as p,q as B,ab as U,b4 as _e,a3 as D,I as ce,b3 as pe,al as me,aj as ve,av as fe,ao as ye,aO as ge,_ as be}from"./index-61294aba.js";/* empty css                 *//* empty css                  *//* empty css                   *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                 *//* empty css               *//* empty css                *//* empty css                     *//* empty css                  */const we={class:"questions-overview"},he={class:"page-header"},Ce={class:"header-actions"},ke={class:"statistics-container"},je={class:"statistic-icon users"},qe={class:"statistic-icon requisitions"},Ee={class:"statistic-icon questioned"},$e={class:"statistic-icon rejected"},Ve={class:"table-container"},xe={class:"table-header"},Le={key:1},Te={key:1},Ue={key:0,class:"status-good"},ze={key:1,class:"status-summary"},Ie={key:0},Ne={key:0},Qe={key:1},Se={class:"line-message-preview"},Be={style:{"margin-top":"10px"}},De={class:"info-notice"},Oe=H({__name:"QuestionsOverview",setup(Me){const x=_(!1),C=_(!1),k=_([]),j=_([]),q=_(!1),b=_(!1),z=_({}),r=_(null),w=_(""),h=_(""),g=_({total_users:0,total_items:0,total_questioned:0,total_rejected:0}),O=J(()=>h.value?k.value.filter(o=>o.display_name.toLowerCase().includes(h.value.toLowerCase())||o.username.toLowerCase().includes(h.value.toLowerCase())):k.value),M=async()=>{var o;x.value=!0;try{const e=await D.get("/requisitions/user-statistics"),a=((o=e.data)==null?void 0:o.data)||e.data||{};k.value=a.user_statistics||[],g.value=a.summary||{total_users:0,total_items:0,total_questioned:0,total_rejected:0}}catch(e){console.error("è¼‰å…¥ç”¨æˆ¶çµ±è¨ˆå¤±æ•—:",e),y.error("è¼‰å…¥ç”¨æˆ¶çµ±è¨ˆå¤±æ•—")}finally{x.value=!1}},A=async()=>{var o;try{const e=await D.get("/requisitions/questions-data"),a=((o=e.data)==null?void 0:o.data)||e.data||{};j.value=a.user_questions||[]}catch(e){console.error("è¼‰å…¥ç–‘å•è³‡æ–™å¤±æ•—:",e),y.error("è¼‰å…¥ç–‘å•è³‡æ–™å¤±æ•—")}},I=async()=>{await Promise.all([M(),A()]),y.success("è³‡æ–™å·²é‡æ–°æ•´ç†")},P=async o=>{z.value=o;const e=j.value.find(a=>a.username===o.username||a.username===o.display_name);r.value=e||{questions:[],rejections:[]},w.value=N(o,r.value),q.value=!0},N=(o,e)=>{let a=`è«‹è³¼é …ç›®ç‹€æ…‹é€šçŸ¥

`;return a+=`${o.display_name}
`,o.questioned_items>0&&(a+=`æœ‰ç–‘å•é …ç›®: ${o.questioned_items} å€‹
`),o.rejected_items>0&&(a+=`æ‹’çµ•é …ç›®: ${o.rejected_items} å€‹
`),a+=`
`,e.questions&&e.questions.length>0&&(a+=`ç–‘å•é …ç›®è©³æƒ…:
`,e.questions.forEach((i,m)=>{a+=`${m+1}. ${i.item_name||"æœªçŸ¥ç‰©å“"}`,i.status_note?a+=` - ${i.status_note}
`:a+=` - æœ‰ç–‘å•
`,a+=`   è«‹è³¼å–®è™Ÿ: ${i.request_order_no}
`}),a+=`
`),e.rejections&&e.rejections.length>0&&(a+=`æ‹’çµ•é …ç›®è©³æƒ…:
`,e.rejections.forEach((i,m)=>{a+=`${m+1}. ${i.item_name||"æœªçŸ¥ç‰©å“"}`,i.status_note?a+=` - ${i.status_note}
`:a+=` - å·²æ‹’çµ•
`,a+=`   è«‹è³¼å–®è™Ÿ: ${i.request_order_no}
`}),a+=`
`),a+=`è«‹ç›¡å¿«è™•ç†ä¸Šè¿°é …ç›®å•é¡Œï¼Œå¦‚æœ‰ç–‘å•è«‹è¯ç¹«æ¡è³¼éƒ¨é–€ã€‚
`,a+=`
${new Date().toLocaleString("zh-TW")}`,a},R=async o=>{const e=j.value.find(i=>i.username===o.username||i.username===o.display_name),a=N(o,e||{questions:[],rejections:[]});await L(a)},L=async o=>{try{await navigator.clipboard.writeText(o),y.success("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼å¯ä»¥è²¼åˆ°LINEä¸­ç™¼é€ã€‚")}catch(e){console.error("è¤‡è£½å¤±æ•—:",e),y.error("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½")}},W=()=>{b.value=!0},G=async()=>{C.value=!0;try{await new Promise(o=>setTimeout(o,1e3)),k.value=[],j.value=[],g.value={total_users:0,total_items:0,total_questioned:0,total_rejected:0},b.value=!1,y.success("æ‰€æœ‰ç–‘å•è³‡æ–™å·²æ¸…é™¤")}catch(o){console.error("æ¸…é™¤è³‡æ–™å¤±æ•—:",o),y.error("æ¸…é™¤è³‡æ–™å¤±æ•—")}finally{C.value=!1}};return Y(()=>{I()}),(o,e)=>{const a=ce,i=Z,m=pe,E=me,$=ve,K=ee,Q=te,u=fe,V=ye,T=se,S=ae,X=ge;return c(),v("div",we,[n("div",he,[e[10]||(e[10]=n("h1",{class:"page-title"},"ç–‘å•ç¸½è¦½",-1)),n("div",Ce,[t(i,{type:"primary",onClick:I},{default:s(()=>[t(a,null,{default:s(()=>[t(f(le))]),_:1}),e[8]||(e[8]=d(" é‡æ–°æ•´ç† ",-1))]),_:1}),t(i,{type:"info",onClick:W,loading:C.value},{default:s(()=>[t(a,null,{default:s(()=>[t(f(oe))]),_:1}),e[9]||(e[9]=d(" æ¸…é™¤æ‰€æœ‰è³‡æ–™ ",-1))]),_:1},8,["loading"])])]),n("div",ke,[t(K,{gutter:20},{default:s(()=>[t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"ç¸½æäº¤ç”¨æˆ¶",value:g.value.total_users},null,8,["value"]),n("div",je,[t(a,null,{default:s(()=>[t(f(ie))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"ç¸½è«‹è³¼é …ç›®",value:g.value.total_items},null,8,["value"]),n("div",qe,[t(a,null,{default:s(()=>[t(f(ne))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"æœ‰ç–‘å•é …ç›®",value:g.value.total_questioned},null,8,["value"]),n("div",Ee,[t(a,null,{default:s(()=>[t(f(ue))]),_:1})])]),_:1})]),_:1}),t($,{span:6},{default:s(()=>[t(E,{class:"statistic-card"},{default:s(()=>[t(m,{title:"æ‹’çµ•é …ç›®",value:g.value.total_rejected},null,8,["value"]),n("div",$e,[t(a,null,{default:s(()=>[t(f(de))]),_:1})])]),_:1})]),_:1})]),_:1})]),n("div",Ve,[n("div",xe,[e[11]||(e[11]=n("h2",null,"ç”¨æˆ¶è«‹è³¼çµ±è¨ˆ",-1)),t(Q,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=l=>h.value=l),placeholder:"æœå°‹ç”¨æˆ¶...",style:{width:"200px"},clearable:""},{prefix:s(()=>[t(a,null,{default:s(()=>[t(f(re))]),_:1})]),_:1},8,["modelValue"])]),t(T,{data:O.value,loading:x.value,stripe:"",style:{width:"100%"}},{default:s(()=>[t(u,{prop:"display_name",label:"ç”¨æˆ¶åç¨±",width:"150"}),t(u,{prop:"total_items",label:"ç¸½è«‹è³¼é …ç›®",width:"120",align:"center"},{default:s(({row:l})=>[t(V,{type:"info",size:"small"},{default:s(()=>[d(p(l.total_items),1)]),_:2},1024)]),_:1}),t(u,{prop:"questioned_items",label:"æœ‰ç–‘å•é …ç›®",width:"120",align:"center"},{default:s(({row:l})=>[l.questioned_items>0?(c(),B(V,{key:0,type:"warning",size:"small"},{default:s(()=>[d(p(l.questioned_items),1)]),_:2},1024)):(c(),v("span",Le,"0"))]),_:1}),t(u,{prop:"rejected_items",label:"æ‹’çµ•é …ç›®",width:"120",align:"center"},{default:s(({row:l})=>[l.rejected_items>0?(c(),B(V,{key:0,type:"danger",size:"small"},{default:s(()=>[d(p(l.rejected_items),1)]),_:2},1024)):(c(),v("span",Te,"0"))]),_:1}),t(u,{prop:"total_problematic",label:"å•é¡Œç¸½æ•¸",width:"120",align:"center"},{default:s(({row:l})=>[t(V,{type:l.total_problematic>0?"danger":"success",size:"small"},{default:s(()=>[d(p(l.total_problematic),1)]),_:2},1032,["type"])]),_:1}),t(u,{label:"ç‹€æ…‹æ‘˜è¦","min-width":"200"},{default:s(({row:l})=>[l.total_problematic===0?(c(),v("span",Ue," âœ… æ‰€æœ‰è«‹è³¼é …ç›®æ­£å¸¸ ")):(c(),v("span",ze,p(l.display_name)+" - "+p(l.total_items)+" å€‹è«‹è³¼é …ç›®å·²æäº¤ï¼Œ "+p(l.questioned_items)+" å€‹æœ‰ç–‘å•ï¼Œ "+p(l.rejected_items)+" å€‹è¢«æ‹’çµ• ",1))]),_:1}),t(u,{label:"æ“ä½œ",width:"180",align:"center"},{default:s(({row:l})=>[t(i,{size:"small",type:"primary",onClick:F=>P(l),disabled:l.total_problematic===0},{default:s(()=>[...e[12]||(e[12]=[d(" æŸ¥çœ‹è©³æƒ… ",-1)])]),_:1},8,["onClick","disabled"]),t(i,{size:"small",type:"success",onClick:F=>R(l),disabled:l.total_problematic===0},{default:s(()=>[...e[13]||(e[13]=[d(" è¤‡è£½LINEè¨Šæ¯ ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data","loading"])]),t(S,{modelValue:q.value,"onUpdate:modelValue":e[5]||(e[5]=l=>q.value=l),title:`${z.value.display_name} çš„ç–‘å•è©³æƒ…`,width:"900px","close-on-click-modal":!1},{footer:s(()=>[t(i,{onClick:e[3]||(e[3]=l=>q.value=!1)},{default:s(()=>[...e[16]||(e[16]=[d("é—œé–‰",-1)])]),_:1}),t(i,{type:"success",onClick:e[4]||(e[4]=l=>L(w.value))},{default:s(()=>[...e[17]||(e[17]=[d(" è¤‡è£½LINEè¨Šæ¯ ",-1)])]),_:1})]),default:s(()=>[r.value?(c(),v("div",Ie,[r.value.questions&&r.value.questions.length>0?(c(),v("div",Ne,[n("h4",null,"â“ ç–‘å•é …ç›® ("+p(r.value.questions.length)+")",1),t(T,{data:r.value.questions,size:"small",style:{"margin-bottom":"20px"}},{default:s(()=>[t(u,{prop:"request_order_no",label:"è«‹è³¼å–®è™Ÿ",width:"120"}),t(u,{prop:"item_name",label:"é …ç›®åç¨±",width:"150"}),t(u,{prop:"status_note",label:"ç–‘å•å…§å®¹","min-width":"200"}),t(u,{prop:"submit_date",label:"æäº¤æ—¥æœŸ",width:"100"})]),_:1},8,["data"])])):U("",!0),r.value.rejections&&r.value.rejections.length>0?(c(),v("div",Qe,[n("h4",null,"âŒ æ‹’çµ•é …ç›® ("+p(r.value.rejections.length)+")",1),t(T,{data:r.value.rejections,size:"small"},{default:s(()=>[t(u,{prop:"request_order_no",label:"è«‹è³¼å–®è™Ÿ",width:"120"}),t(u,{prop:"item_name",label:"é …ç›®åç¨±",width:"150"}),t(u,{prop:"status_note",label:"æ‹’çµ•åŸå› ","min-width":"200"}),t(u,{prop:"submit_date",label:"æäº¤æ—¥æœŸ",width:"100"})]),_:1},8,["data"])])):U("",!0),n("div",Se,[e[15]||(e[15]=n("h4",null,"ğŸ“± LINE è¨Šæ¯é è¦½",-1)),t(Q,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),type:"textarea",rows:6,readonly:"",class:"line-message-text"},null,8,["modelValue"]),n("div",Be,[t(i,{type:"success",onClick:e[2]||(e[2]=l=>L(w.value))},{default:s(()=>[t(a,null,{default:s(()=>[t(f(_e))]),_:1}),e[14]||(e[14]=d(" è¤‡è£½åˆ°å‰ªè²¼ç°¿ ",-1))]),_:1})])])])):U("",!0)]),_:1},8,["modelValue","title"]),t(S,{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=l=>b.value=l),title:"ç¢ºèªæ¸…é™¤è³‡æ–™",width:"400px"},{footer:s(()=>[t(i,{onClick:e[6]||(e[6]=l=>b.value=!1)},{default:s(()=>[...e[18]||(e[18]=[d("å–æ¶ˆ",-1)])]),_:1}),t(i,{type:"danger",onClick:G,loading:C.value},{default:s(()=>[...e[19]||(e[19]=[d(" ç¢ºå®šæ¸…é™¤ ",-1)])]),_:1},8,["loading"])]),default:s(()=>[e[20]||(e[20]=n("p",null,"æ‚¨ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç–‘å•å’Œæ‹’çµ•è³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ã€‚",-1))]),_:1},8,["modelValue"]),n("div",De,[t(X,{title:"åŠŸèƒ½èªªæ˜",description:"æ­¤é é¢é¡¯ç¤ºæ‰€æœ‰ç”¨æˆ¶çš„è«‹è³¼å–®çµ±è¨ˆï¼ŒåŒ…æ‹¬ç–‘å•å’Œæ‹’çµ•çš„é …ç›®ã€‚æ‚¨å¯ä»¥æŸ¥çœ‹è©³æƒ…ä¸¦è¤‡è£½LINEè¨Šæ¯ä¾†é€šçŸ¥ç”¨æˆ¶ã€‚",type:"info","show-icon":"",closable:!1})])])}}});const tt=be(Oe,[["__scopeId","data-v-9ee8c2ec"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/purchase-orders/QuestionsOverview.vue"]]);export{tt as default};
//# sourceMappingURL=QuestionsOverview-25c1d8f6.js.map
