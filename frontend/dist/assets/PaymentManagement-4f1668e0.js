import{d as ie,u as re,r as S,a as k,a1 as de,c as z,b as s,e as l,w as n,a3 as $,X as C,al as ue,T as pe,o as g,t as o,F as I,s as L,q as T,i,aP as me,H as _e,ah as ce,ai as fe,m as ge,av as ye,ao as ve,aw as be,ax as he,k as we,aC as Ce,aD as xe,j as Ee,E as ke,aJ as Ve,aK as Pe,aS as Se,_ as ze}from"./index-61294aba.js";/* empty css                   *//* empty css                             *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                       *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                *//* empty css                       */const Te={class:"payment-management"},De={class:"header-section"},$e={class:"statistics-cards"},Ae={class:"stat-content"},Be={class:"stat-value"},Me={class:"stat-count"},Oe={class:"stat-content"},Ue={class:"stat-value"},Fe={class:"stat-count"},Ne={class:"stat-content"},Re={class:"stat-value"},je={class:"stat-content"},Ie={class:"stat-value"},Le={class:"filter-row"},qe={key:0},Ge={key:1},Ke={class:"pagination-container"},He={class:"po-list"},Je={class:"total-amount"},We=ie({__name:"PaymentManagement",setup(Xe){re();const A=S(!1),B=S(!1),M=S([]),V=S([]),O=S([]),v=k({unpaid:{count:0,amount:0},paid:{count:0,amount:0,by_method:{remittance:0,check:0}},total:{count:0,amount:0}}),b=k({status:"unpaid",supplier_id:""}),y=k({page:1,pageSize:20,total:0}),u=k({visible:!1,title:"",orders:[],totalAmount:0}),m=k({payment_method:"電匯",payment_note:""}),_=k({visible:!1,order:null}),x=async()=>{var a,t,p,r,f;A.value=!0;try{const c={page:y.page,page_size:y.pageSize,status:b.status};b.supplier_id&&(c.supplier_id=b.supplier_id);const d=await $.get("/accounting/payment-management/list",{params:c});d.data&&(d.data.success===!0&&d.data.data?(M.value=d.data.data.items||[],y.total=((a=d.data.data.pagination)==null?void 0:a.total)||0):d.data.items!==void 0&&(M.value=d.data.items||[],y.total=((t=d.data.pagination)==null?void 0:t.total)||0))}catch(c){console.error("Load error:",c),C.error(((f=(r=(p=c.response)==null?void 0:p.data)==null?void 0:r.error)==null?void 0:f.message)||"載入採購單失敗")}finally{A.value=!1}},U=async()=>{try{const a=await $.get("/accounting/payment-management/summary");a.data&&(a.data.success===!0&&a.data.data?Object.assign(v,a.data.data):(a.data.unpaid!==void 0||a.data.paid!==void 0)&&Object.assign(v,a.data))}catch(a){console.error("Summary error:",a)}},q=async()=>{try{const a=await $.get("/suppliers");a.data&&(a.data.success===!0&&a.data.data?O.value=a.data.data:Array.isArray(a.data)&&(O.value=a.data))}catch(a){console.error("Suppliers error:",a)}},G=a=>{V.value=a.filter(t=>t.billing_status!=="paid")},K=a=>{u.title="設定付款",u.orders=[a.purchase_order_no],u.totalAmount=a.grand_total_int,u.visible=!0,m.payment_method="電匯",m.payment_note=""},H=()=>{if(V.value.length===0){C.warning("請選擇要付款的採購單");return}const a=V.value.filter(t=>t.billing_status!=="paid");if(a.length===0){C.warning("所選採購單都已付款");return}u.title=`批次設定付款 (${a.length} 筆)`,u.orders=a.map(t=>t.purchase_order_no),u.totalAmount=a.reduce((t,p)=>t+p.grand_total_int,0),u.visible=!0,m.payment_method="電匯",m.payment_note=""},J=async()=>{var a,t,p;if(!m.payment_method){C.warning("請選擇付款方式");return}try{await _e.confirm(`確定要將 ${u.orders.length} 筆採購單設定為已付款嗎？`,"確認付款",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}),B.value=!0;const r=await $.post("/accounting/payment-management/update-payment",{purchase_order_nos:u.orders,payment_method:m.payment_method,payment_note:m.payment_note});let f=0;r.data&&(r.data.success===!0&&r.data.data?f=r.data.data.updated_count||0:r.data.updated_count!==void 0&&(f=r.data.updated_count||0)),f>0?(C.success(`成功設定 ${f} 筆採購單為已付款`),u.visible=!1,await Promise.all([x(),U()])):C.warning("未更新任何採購單")}catch(r){r!=="cancel"&&(console.error("Payment error:",r),C.error(((p=(t=(a=r.response)==null?void 0:a.data)==null?void 0:t.error)==null?void 0:p.message)||"付款設定失敗"))}finally{B.value=!1}},W=a=>{_.order=a,_.visible=!0},X=({row:a})=>a.billing_status==="paid"?"paid-row":"",h=a=>a?`NT$${a.toLocaleString()}`:"NT$0",Q=a=>a?a.split("T")[0]:"-",Y=a=>({none:"warning",pending:"info",billed:"primary",paid:"success"})[a]||"info",Z=a=>({none:"未付款",pending:"待付款",billed:"已請款",paid:"已付款"})[a]||a,F=a=>({remittance:"電匯",check:"支票",cash:"現金"})[a]||a;return de(()=>{Promise.all([x(),U(),q()])}),(a,t)=>{const p=ue,r=ce,f=fe,c=ge,d=ye,N=ve,ee=be,te=he,D=we,R=Ce,ae=xe,le=Ee,ne=ke,j=pe,E=Ve,se=Pe,oe=Se;return g(),z("div",Te,[s("div",De,[t[14]||(t[14]=s("h2",null,"付款管理",-1)),s("div",$e,[l(p,{class:"stat-card"},{default:n(()=>[s("div",Ae,[t[10]||(t[10]=s("div",{class:"stat-label"},"未付款",-1)),s("div",Be,o(h(v.unpaid.amount)),1),s("div",Me,o(v.unpaid.count)+" 筆",1)])]),_:1}),l(p,{class:"stat-card"},{default:n(()=>[s("div",Oe,[t[11]||(t[11]=s("div",{class:"stat-label"},"已付款",-1)),s("div",Ue,o(h(v.paid.amount)),1),s("div",Fe,o(v.paid.count)+" 筆",1)])]),_:1}),l(p,{class:"stat-card"},{default:n(()=>{var e;return[s("div",Ne,[t[12]||(t[12]=s("div",{class:"stat-label"},"電匯付款",-1)),s("div",Re,o(h(((e=v.paid.by_method)==null?void 0:e.remittance)||0)),1)])]}),_:1}),l(p,{class:"stat-card"},{default:n(()=>{var e;return[s("div",je,[t[13]||(t[13]=s("div",{class:"stat-label"},"支票付款",-1)),s("div",Ie,o(h(((e=v.paid.by_method)==null?void 0:e.check)||0)),1)])]}),_:1})])]),l(p,{class:"filter-section"},{default:n(()=>[s("div",Le,[l(f,{modelValue:b.status,"onUpdate:modelValue":t[0]||(t[0]=e=>b.status=e),placeholder:"付款狀態",onChange:x,clearable:""},{default:n(()=>[l(r,{label:"未付款",value:"unpaid"}),l(r,{label:"已付款",value:"paid"}),l(r,{label:"全部",value:"all"})]),_:1},8,["modelValue"]),l(f,{modelValue:b.supplier_id,"onUpdate:modelValue":t[1]||(t[1]=e=>b.supplier_id=e),placeholder:"選擇供應商",onChange:x,clearable:"",filterable:""},{default:n(()=>[(g(!0),z(I,null,L(O.value,e=>(g(),T(r,{key:e.supplier_id,label:e.supplier_name_zh||e.supplier_name_en,value:e.supplier_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(c,{type:"primary",onClick:H,disabled:V.value.length===0},{default:n(()=>[i(" 批次設定付款 ("+o(V.value.length)+") ",1)]),_:1},8,["disabled"])])]),_:1}),l(p,{class:"table-section"},{default:n(()=>[me((g(),T(ee,{data:M.value,onSelectionChange:G,"row-class-name":X},{default:n(()=>[l(d,{type:"selection",width:"50"}),l(d,{prop:"purchase_order_no",label:"採購單號",width:"150"}),l(d,{label:"供應商","min-width":"200"},{default:n(({row:e})=>{var w,P;return[i(o(((w=e.supplier_info)==null?void 0:w.supplier_name_zh)||((P=e.supplier_info)==null?void 0:P.supplier_name_en)||e.supplier_name),1)]}),_:1}),l(d,{label:"金額",width:"120",align:"right"},{default:n(({row:e})=>[i(o(h(e.grand_total_int)),1)]),_:1}),l(d,{label:"付款狀態",width:"100"},{default:n(({row:e})=>[l(N,{type:Y(e.billing_status)},{default:n(()=>[i(o(Z(e.billing_status)),1)]),_:2},1032,["type"])]),_:1}),l(d,{label:"付款方式",width:"100"},{default:n(({row:e})=>[e.payment_method?(g(),z("span",qe,o(F(e.payment_method)),1)):(g(),z("span",Ge,"-"))]),_:1}),l(d,{label:"付款日期",width:"120"},{default:n(({row:e})=>[i(o(e.payment_date||"-"),1)]),_:1}),l(d,{label:"建立日期",width:"120"},{default:n(({row:e})=>[i(o(Q(e.created_at)),1)]),_:1}),l(d,{label:"操作",width:"150",fixed:"right"},{default:n(({row:e})=>[e.billing_status!=="paid"?(g(),T(c,{key:0,type:"primary",size:"small",onClick:w=>K(e)},{default:n(()=>[...t[15]||(t[15]=[i(" 設定付款 ",-1)])]),_:1},8,["onClick"])):(g(),T(c,{key:1,type:"info",size:"small",onClick:w=>W(e)},{default:n(()=>[...t[16]||(t[16]=[i(" 查看詳情 ",-1)])]),_:1},8,["onClick"]))]),_:1})]),_:1},8,["data"])),[[oe,A.value]]),s("div",Ke,[l(te,{"current-page":y.page,"onUpdate:currentPage":t[2]||(t[2]=e=>y.page=e),"page-size":y.pageSize,"onUpdate:pageSize":t[3]||(t[3]=e=>y.pageSize=e),total:y.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:x,onCurrentChange:x},null,8,["current-page","page-size","total"])])]),_:1}),l(j,{modelValue:u.visible,"onUpdate:modelValue":t[7]||(t[7]=e=>u.visible=e),title:u.title,width:"600px"},{footer:n(()=>[l(c,{onClick:t[6]||(t[6]=e=>u.visible=!1)},{default:n(()=>[...t[19]||(t[19]=[i("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:J,loading:B.value},{default:n(()=>[...t[20]||(t[20]=[i(" 確認付款 ",-1)])]),_:1},8,["loading"])]),default:n(()=>[l(ne,{ref:"paymentFormRef",model:m,"label-width":"120px"},{default:n(()=>[l(D,{label:"採購單號"},{default:n(()=>[s("div",He,[(g(!0),z(I,null,L(u.orders,e=>(g(),T(N,{key:e,class:"po-tag"},{default:n(()=>[i(o(e),1)]),_:2},1024))),128))])]),_:1}),l(D,{label:"總金額"},{default:n(()=>[s("div",Je,o(h(u.totalAmount)),1)]),_:1}),l(D,{label:"付款方式",required:""},{default:n(()=>[l(ae,{modelValue:m.payment_method,"onUpdate:modelValue":t[4]||(t[4]=e=>m.payment_method=e)},{default:n(()=>[l(R,{label:"電匯"},{default:n(()=>[...t[17]||(t[17]=[i("電匯",-1)])]),_:1}),l(R,{label:"支票"},{default:n(()=>[...t[18]||(t[18]=[i("支票",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(D,{label:"付款備註"},{default:n(()=>[l(le,{modelValue:m.payment_note,"onUpdate:modelValue":t[5]||(t[5]=e=>m.payment_note=e),type:"textarea",rows:3,placeholder:"請輸入付款備註（選填）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(j,{modelValue:_.visible,"onUpdate:modelValue":t[9]||(t[9]=e=>_.visible=e),title:"付款詳情",width:"500px"},{footer:n(()=>[l(c,{onClick:t[8]||(t[8]=e=>_.visible=!1)},{default:n(()=>[...t[21]||(t[21]=[i("關閉",-1)])]),_:1})]),default:n(()=>[l(se,{column:1,border:""},{default:n(()=>[l(E,{label:"採購單號"},{default:n(()=>{var e;return[i(o((e=_.order)==null?void 0:e.purchase_order_no),1)]}),_:1}),l(E,{label:"供應商"},{default:n(()=>{var e,w,P;return[i(o(((w=(e=_.order)==null?void 0:e.supplier_info)==null?void 0:w.supplier_name_zh)||((P=_.order)==null?void 0:P.supplier_name)),1)]}),_:1}),l(E,{label:"金額"},{default:n(()=>{var e;return[i(o(h((e=_.order)==null?void 0:e.grand_total_int)),1)]}),_:1}),l(E,{label:"付款方式"},{default:n(()=>{var e;return[i(o(F((e=_.order)==null?void 0:e.payment_method)),1)]}),_:1}),l(E,{label:"付款日期"},{default:n(()=>{var e;return[i(o((e=_.order)==null?void 0:e.payment_date),1)]}),_:1}),l(E,{label:"付款備註"},{default:n(()=>{var e;return[i(o(((e=_.order)==null?void 0:e.payment_note)||"無"),1)]}),_:1})]),_:1})]),_:1},8,["modelValue"])])}}});const ft=ze(We,[["__scopeId","data-v-9448c621"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/accounting/PaymentManagement.vue"]]);export{ft as default};
//# sourceMappingURL=PaymentManagement-4f1668e0.js.map
