{"version":3,"file":"List-15767586.js","sources":["../../src/views/projects/List.vue"],"sourcesContent":["<template>\r\n  <div class=\"projects-list\">\r\n    <div class=\"page-header\">\r\n      <h1>專案管理</h1>\r\n      <el-button type=\"primary\" icon=\"Plus\" @click=\"handleCreate\">新增專案</el-button>\r\n    </div>\r\n\r\n    <div class=\"filter-section\">\r\n      <el-form :inline=\"true\" :model=\"filters\" class=\"filter-form\">\r\n        <el-form-item label=\"專案狀態\">\r\n          <el-select \r\n            v-model=\"filters.status\" \r\n            placeholder=\"全部狀態\" \r\n            clearable\r\n            style=\"width: 150px\"\r\n          >\r\n            <el-option label=\"進行中\" value=\"ongoing\" />\r\n            <el-option label=\"已完成\" value=\"completed\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"搜尋\">\r\n          <el-input \r\n            v-model=\"filters.search\" \r\n            placeholder=\"專案名稱/客戶名稱\"\r\n            clearable\r\n            style=\"width: 250px\"\r\n            @keyup.enter=\"handleSearch\"\r\n          />\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" icon=\"Search\" @click=\"handleSearch\">查詢</el-button>\r\n          <el-button icon=\"Refresh\" @click=\"handleReset\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n\r\n    <el-card>\r\n      <el-table :data=\"projects\" v-loading=\"loading\" stripe>\r\n        <el-table-column prop=\"project_code\" label=\"專案代碼\" width=\"120\" />\r\n        <el-table-column prop=\"project_name\" label=\"專案名稱\" min-width=\"200\">\r\n          <template #default=\"scope\">\r\n            <el-link type=\"primary\" @click=\"viewDetail(scope.row)\">\r\n              {{ scope.row.project_name }}\r\n            </el-link>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"project_status\" label=\"狀態\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.project_status === 'ongoing' ? 'success' : 'info'\">\r\n              {{ scope.row.project_status === 'ongoing' ? '進行中' : '已完成' }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"budget\" label=\"預算\" width=\"150\" align=\"right\">\r\n          <template #default=\"scope\">\r\n            <span v-if=\"scope.row.budget\">NT$ {{ formatAmount(scope.row.budget) }}</span>\r\n            <span v-else>-</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"total_expenditure\" label=\"已花費\" width=\"150\" align=\"right\">\r\n          <template #default=\"scope\">\r\n            NT$ {{ formatAmount(scope.row.total_expenditure || 0) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"預算使用率\" width=\"150\">\r\n          <template #default=\"scope\">\r\n            <el-progress \r\n              v-if=\"scope.row.budget && scope.row.budget > 0\"\r\n              :percentage=\"Math.min(100, Math.round((scope.row.total_expenditure || 0) / scope.row.budget * 100))\"\r\n              :status=\"getProgressStatus(scope.row)\"\r\n            />\r\n            <span v-else>-</span>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"start_date\" label=\"開始日期\" width=\"120\">\r\n          <template #default=\"scope\">\r\n            {{ formatDate(scope.row.start_date) }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"manager\" label=\"負責人\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            {{ scope.row.manager?.chinese_name || '-' }}\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column label=\"操作\" width=\"150\" fixed=\"right\">\r\n          <template #default=\"scope\">\r\n            <el-button size=\"small\" type=\"primary\" @click=\"viewDetail(scope.row)\">查看</el-button>\r\n            <el-button size=\"small\" @click=\"handleEdit(scope.row)\">編輯</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <div class=\"pagination-wrapper\">\r\n        <el-pagination\r\n          v-model:current-page=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          :page-sizes=\"[10, 20, 50, 100]\"\r\n          :total=\"total\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          background\r\n          @size-change=\"fetchProjects\"\r\n          @current-change=\"fetchProjects\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, onMounted, reactive } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\nimport { projectsApi } from '@/api/projects'\r\n\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\nconst projects = ref<any[]>([])\r\nconst currentPage = ref(1)\r\nconst pageSize = ref(20)\r\nconst total = ref(0)\r\n\r\nconst filters = reactive({\r\n  status: '',\r\n  search: ''\r\n})\r\n\r\nconst fetchProjects = async () => {\r\n  loading.value = true\r\n  try {\r\n    const response = await projectsApi.getProjects({\r\n      page: currentPage.value,\r\n      page_size: pageSize.value,\r\n      status: filters.status as any,\r\n      search: filters.search\r\n    })\r\n    \r\n    const data = response.data || response\r\n    projects.value = data.data || data.items || []\r\n    total.value = data.pagination?.total || data.total || 0\r\n  } catch (error) {\r\n    console.error('Failed to fetch projects:', error)\r\n    ElMessage.error('載入專案列表失敗')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst handleSearch = () => {\r\n  currentPage.value = 1\r\n  fetchProjects()\r\n}\r\n\r\nconst handleReset = () => {\r\n  filters.status = ''\r\n  filters.search = ''\r\n  currentPage.value = 1\r\n  fetchProjects()\r\n}\r\n\r\nconst handleCreate = () => {\r\n  router.push('/projects/create')\r\n}\r\n\r\nconst viewDetail = (project: any) => {\r\n  router.push(`/projects/${project.project_id}`)\r\n}\r\n\r\nconst handleEdit = (project: any) => {\r\n  router.push(`/projects/${project.project_id}/edit`)\r\n}\r\n\r\nconst formatAmount = (amount: number) => {\r\n  return amount.toLocaleString('zh-TW')\r\n}\r\n\r\nconst formatDate = (dateStr: string) => {\r\n  if (!dateStr) return '-'\r\n  return new Date(dateStr).toLocaleDateString('zh-TW')\r\n}\r\n\r\nconst getProgressStatus = (project: any) => {\r\n  const usage = (project.total_expenditure || 0) / project.budget * 100\r\n  if (usage >= 90) return 'exception'\r\n  if (usage >= 70) return 'warning'\r\n  return 'success'\r\n}\r\n\r\nonMounted(() => {\r\n  fetchProjects()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.projects-list {\r\n  padding: 20px;\r\n}\r\n\r\n.page-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.page-header h1 {\r\n  font-size: 24px;\r\n  margin: 0;\r\n  color: #303133;\r\n}\r\n\r\n.filter-section {\r\n  background: white;\r\n  padding: 20px;\r\n  margin-bottom: 20px;\r\n  border-radius: 8px;\r\n}\r\n\r\n.pagination-wrapper {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n</style>"],"names":["router","useRouter","loading","ref","projects","currentPage","pageSize","total","filters","reactive","fetchProjects","response","projectsApi","data","_a","error","ElMessage","handleSearch","handleReset","handleCreate","viewDetail","project","handleEdit","formatAmount","amount","formatDate","dateStr","getProgressStatus","usage","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_createVNode","_component_el_button","_createTextVNode","_component_el_form","_component_el_form_item","_withCtx","_component_el_select","$event","_component_el_option","_component_el_input","_withKeys","_withDirectives","_createBlock","_component_el_table","_component_el_table_column","_component_el_link","scope","_toDisplayString","_component_el_tag","_hoisted_4","_hoisted_5","_component_el_progress","_hoisted_6","_component_el_pagination"],"mappings":"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"}