import{d as N,u as O,r as f,a as x,a1 as W,c as L,b as i,e as r,w as a,a3 as y,X as c,al as z,o as V,q as C,i as p,ab as M,t as g,m as G,j as K,k as X,ao as H,E as J,_ as Q}from"./index-61294aba.js";/* empty css                *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                  */const Y={class:"profile-container"},Z={class:"profile-content"},$={class:"card-header"},ee=N({__name:"Profile",setup(re){const R=O(),b=f(),w=f(),m=f(!1),_=f(!1),t=x({username:"",chinese_name:"",job_title:"",department:"",role:"",is_active:!0,created_at:"",updated_at:""}),v=f({}),d=x({current_password:"",new_password:"",confirm_password:""}),h={chinese_name:[{required:!0,message:"請輸入暱稱",trigger:"blur"},{min:2,max:20,message:"暱稱長度在 2 到 20 個字符",trigger:"blur"}],job_title:[{max:50,message:"職稱不能超過 50 個字符",trigger:"blur"}],department:[{max:50,message:"部門名稱不能超過 50 個字符",trigger:"blur"}]},T={current_password:[{required:!0,message:"請輸入當前密碼",trigger:"blur"}],new_password:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{min:6,message:"密碼長度至少 6 個字符",trigger:"blur"}],confirm_password:[{required:!0,message:"請確認新密碼",trigger:"blur"},{validator:(o,e,n)=>{e!==d.new_password?n(new Error("兩次輸入的密碼不一致")):n()},trigger:"blur"}]},U=async()=>{_.value=!0;try{const e=(await y.get("/profile")).data.data;Object.assign(t,e),v.value={...e}}catch(o){console.error("Failed to load profile:",o),c.error("載入個人資料失敗")}finally{_.value=!1}},I=()=>{m.value=!0,v.value={...t}},A=()=>{Object.assign(t,v.value),m.value=!1},D=async()=>{b.value&&await b.value.validate(async o=>{if(o)try{_.value=!0;const e=await y.put("/profile",{chinese_name:t.chinese_name,job_title:t.job_title,department:t.department}),n=e.data.data||e.data,s=n.user||n;Object.assign(t,s),R.updateUserProfile({chinese_name:s.chinese_name,job_title:s.job_title,department:s.department}),m.value=!1,c.success("個人資料更新成功")}catch(e){console.error("Failed to update profile:",e),c.error("更新個人資料失敗")}finally{_.value=!1}})},S=async()=>{w.value&&await w.value.validate(async o=>{var e,n,s;if(o)try{_.value=!0,await y.put("/profile/password",{current_password:d.current_password,new_password:d.new_password}),c.success("密碼修改成功"),E()}catch(l){console.error("Failed to change password:",l),((s=(n=(e=l.response)==null?void 0:e.data)==null?void 0:n.error)==null?void 0:s.code)==="INVALID_PASSWORD"?c.error("當前密碼不正確"):c.error("修改密碼失敗")}finally{_.value=!1}})},E=()=>{var o;d.current_password="",d.new_password="",d.confirm_password="",(o=w.value)==null||o.resetFields()},P=o=>o?new Date(o).toLocaleString("zh-TW"):"-",q=o=>({Admin:"系統管理員",Procurement:"採購專員",ProcurementMgr:"採購經理",Manager:"部門經理",IT:"IT專員",Everyone:"一般用戶"})[o]||o,B=o=>({Admin:"danger",ProcurementMgr:"warning",Procurement:"primary",Manager:"success",IT:"info",Everyone:""})[o]||"";return W(()=>{U()}),(o,e)=>{const n=G,s=K,l=X,j=H,F=J,k=z;return V(),L("div",Y,[e[14]||(e[14]=i("div",{class:"profile-header"},[i("h1",null,"個人資料")],-1)),i("div",Z,[r(k,{class:"profile-card"},{header:a(()=>[i("div",$,[e[8]||(e[8]=i("span",null,"基本資訊",-1)),m.value?M("",!0):(V(),C(n,{key:0,type:"primary",onClick:I,icon:"Edit"},{default:a(()=>[...e[7]||(e[7]=[p(" 編輯 ",-1)])]),_:1}))])]),default:a(()=>[r(F,{ref_key:"profileFormRef",ref:b,model:t,rules:h,"label-width":"120px",disabled:!m.value},{default:a(()=>[r(l,{label:"用戶名稱"},{default:a(()=>[r(s,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=u=>t.username=u),disabled:""},null,8,["modelValue"])]),_:1}),r(l,{label:"暱稱",prop:"chinese_name"},{default:a(()=>[r(s,{modelValue:t.chinese_name,"onUpdate:modelValue":e[1]||(e[1]=u=>t.chinese_name=u),placeholder:"請輸入暱稱"},null,8,["modelValue"])]),_:1}),r(l,{label:"職稱",prop:"job_title"},{default:a(()=>[r(s,{modelValue:t.job_title,"onUpdate:modelValue":e[2]||(e[2]=u=>t.job_title=u),placeholder:"請輸入職稱"},null,8,["modelValue"])]),_:1}),r(l,{label:"部門名稱",prop:"department"},{default:a(()=>[r(s,{modelValue:t.department,"onUpdate:modelValue":e[3]||(e[3]=u=>t.department=u),placeholder:"請輸入部門名稱"},null,8,["modelValue"])]),_:1}),r(l,{label:"角色"},{default:a(()=>[r(j,{type:B(t.role)},{default:a(()=>[p(g(q(t.role)),1)]),_:1},8,["type"])]),_:1}),r(l,{label:"帳號狀態"},{default:a(()=>[r(j,{type:t.is_active?"success":"danger"},{default:a(()=>[p(g(t.is_active?"啟用":"停用"),1)]),_:1},8,["type"])]),_:1}),r(l,{label:"建立時間"},{default:a(()=>[i("span",null,g(P(t.created_at)),1)]),_:1}),r(l,{label:"最後更新"},{default:a(()=>[i("span",null,g(P(t.updated_at)),1)]),_:1}),m.value?(V(),C(l,{key:0},{default:a(()=>[r(n,{type:"primary",onClick:D},{default:a(()=>[...e[9]||(e[9]=[p("保存",-1)])]),_:1}),r(n,{onClick:A},{default:a(()=>[...e[10]||(e[10]=[p("取消",-1)])]),_:1})]),_:1})):M("",!0)]),_:1},8,["model","disabled"])]),_:1}),r(k,{class:"password-card"},{header:a(()=>[...e[11]||(e[11]=[i("span",null,"修改密碼",-1)])]),default:a(()=>[r(F,{ref_key:"passwordFormRef",ref:w,model:d,rules:T,"label-width":"120px"},{default:a(()=>[r(l,{label:"當前密碼",prop:"current_password"},{default:a(()=>[r(s,{modelValue:d.current_password,"onUpdate:modelValue":e[4]||(e[4]=u=>d.current_password=u),type:"password",placeholder:"請輸入當前密碼","show-password":""},null,8,["modelValue"])]),_:1}),r(l,{label:"新密碼",prop:"new_password"},{default:a(()=>[r(s,{modelValue:d.new_password,"onUpdate:modelValue":e[5]||(e[5]=u=>d.new_password=u),type:"password",placeholder:"請輸入新密碼（至少6個字符）","show-password":""},null,8,["modelValue"])]),_:1}),r(l,{label:"確認新密碼",prop:"confirm_password"},{default:a(()=>[r(s,{modelValue:d.confirm_password,"onUpdate:modelValue":e[6]||(e[6]=u=>d.confirm_password=u),type:"password",placeholder:"請再次輸入新密碼","show-password":""},null,8,["modelValue"])]),_:1}),r(l,null,{default:a(()=>[r(n,{type:"primary",onClick:S},{default:a(()=>[...e[12]||(e[12]=[p("修改密碼",-1)])]),_:1}),r(n,{onClick:E},{default:a(()=>[...e[13]||(e[13]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])])}}});const de=Q(ee,[["__scopeId","data-v-f32632b7"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/Profile.vue"]]);export{de as default};
//# sourceMappingURL=Profile-282bdf89.js.map
