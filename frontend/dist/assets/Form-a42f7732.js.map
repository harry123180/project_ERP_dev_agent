{"version":3,"file":"Form-a42f7732.js","sources":["../../src/views/requisitions/Form.vue"],"sourcesContent":["<template>\r\n  <div class=\"requisition-form\">\r\n    <PageHeader\r\n      :title=\"isEdit ? '編輯請購單' : '新增請購單'\"\r\n      :subtitle=\"isEdit ? `編輯 ${requisitionId}` : '創建新的請購申請'\"\r\n      :show-back=\"true\"\r\n      @back=\"handleBack\"\r\n    />\r\n\r\n    <el-card>\r\n      <el-form\r\n        ref=\"formRef\"\r\n        :model=\"formData\"\r\n        :rules=\"formRules\"\r\n        label-width=\"120px\"\r\n        @submit.prevent=\"handleSubmit\"\r\n      >\r\n        <!-- Basic Information -->\r\n        <div class=\"form-section\">\r\n          <h3 class=\"section-title\">基本信息</h3>\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"12\">\r\n              <el-form-item label=\"用途類型\" prop=\"usage_type\" required>\r\n                <el-radio-group v-model=\"formData.usage_type\">\r\n                  <el-radio label=\"daily\">日常用品</el-radio>\r\n                  <el-radio label=\"project\">專案用品</el-radio>\r\n                </el-radio-group>\r\n              </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"12\">\r\n              <el-form-item\r\n                v-if=\"formData.usage_type === 'project'\"\r\n                label=\"專案編號\"\r\n                prop=\"project_id\"\r\n                required\r\n              >\r\n                <el-select\r\n                  v-model=\"formData.project_id\"\r\n                  placeholder=\"選擇專案\"\r\n                  filterable\r\n                  clearable\r\n                  style=\"width: 100%\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"project in projects\"\r\n                    :key=\"project.project_id\"\r\n                    :label=\"`${project.project_id} - ${project.project_name}`\"\r\n                    :value=\"project.project_id\"\r\n                  />\r\n                </el-select>\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n\r\n          <!-- 加急設定區塊 -->\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"24\">\r\n              <el-form-item label=\"加急設定\">\r\n                <el-checkbox\r\n                  v-model=\"formData.is_urgent\"\r\n                  @change=\"onUrgentChange\"\r\n                  class=\"urgent-checkbox\"\r\n                >\r\n                  <span class=\"urgent-label\">此為加急請購單</span>\r\n                </el-checkbox>\r\n              </el-form-item>\r\n            </el-col>\r\n          </el-row>\r\n\r\n          <!-- 加急詳細資訊區塊 -->\r\n          <div v-if=\"formData.is_urgent\" class=\"urgent-details\">\r\n            <el-row :gutter=\"20\">\r\n              <el-col :span=\"12\">\r\n                <el-form-item\r\n                  label=\"期望到貨日期\"\r\n                  prop=\"expected_delivery_date\"\r\n                  required\r\n                >\r\n                  <el-date-picker\r\n                    v-model=\"formData.expected_delivery_date\"\r\n                    type=\"date\"\r\n                    placeholder=\"選擇期望到貨日期\"\r\n                    format=\"YYYY/MM/DD\"\r\n                    value-format=\"YYYY-MM-DD\"\r\n                    style=\"width: 100%\"\r\n                    :disabled-date=\"disabledDate\"\r\n                    class=\"urgent-date-picker\"\r\n                  />\r\n                </el-form-item>\r\n              </el-col>\r\n              <el-col :span=\"12\">\r\n                <el-form-item\r\n                  label=\"加急原因\"\r\n                  prop=\"urgent_reason\"\r\n                  required\r\n                >\r\n                  <el-input\r\n                    v-model=\"formData.urgent_reason\"\r\n                    type=\"textarea\"\r\n                    :rows=\"3\"\r\n                    placeholder=\"請詳細說明加急原因\"\r\n                    maxlength=\"200\"\r\n                    show-word-limit\r\n                    class=\"urgent-reason-input\"\r\n                  />\r\n                </el-form-item>\r\n              </el-col>\r\n            </el-row>\r\n          </div>\r\n        </div>\r\n\r\n        <!-- Items List -->\r\n        <div class=\"form-section\">\r\n          <div class=\"section-header\">\r\n            <h3 class=\"section-title\">請購項目</h3>\r\n            <el-button\r\n              type=\"primary\"\r\n              :icon=\"Plus\"\r\n              @click=\"addItem\"\r\n            >\r\n              新增項目\r\n            </el-button>\r\n          </div>\r\n\r\n          <el-table\r\n            :data=\"formData.items\"\r\n            border\r\n            style=\"width: 100%\"\r\n          >\r\n            <el-table-column type=\"index\" label=\"序號\" width=\"60\" align=\"center\" />\r\n            <el-table-column label=\"項目名稱\" min-width=\"150\">\r\n              <template #default=\"{ row, $index }\">\r\n                <el-input\r\n                  v-model=\"row.item_name\"\r\n                  placeholder=\"請輸入項目名稱\"\r\n                  :class=\"{ 'is-error': getFieldError($index, 'item_name') }\"\r\n                />\r\n                <div v-if=\"getFieldError($index, 'item_name')\" class=\"field-error\">\r\n                  {{ getFieldError($index, 'item_name') }}\r\n                </div>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"規格說明\" min-width=\"150\">\r\n              <template #default=\"{ row }\">\r\n                <el-input\r\n                  v-model=\"row.item_specification\"\r\n                  placeholder=\"請輸入規格說明\"\r\n                  type=\"textarea\"\r\n                  :rows=\"2\"\r\n                />\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"數量\" width=\"120\">\r\n              <template #default=\"{ row, $index }\">\r\n                <el-input-number\r\n                  v-model=\"row.item_quantity\"\r\n                  :min=\"1\"\r\n                  :precision=\"0\"\r\n                  controls-position=\"right\"\r\n                  style=\"width: 100%\"\r\n                  :class=\"{ 'is-error': getFieldError($index, 'item_quantity') }\"\r\n                />\r\n                <div v-if=\"getFieldError($index, 'item_quantity')\" class=\"field-error\">\r\n                  {{ getFieldError($index, 'item_quantity') }}\r\n                </div>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"單位\" width=\"100\">\r\n              <template #default=\"{ row }\">\r\n                <el-select\r\n                  v-model=\"row.item_unit\"\r\n                  placeholder=\"選擇單位\"\r\n                  style=\"width: 100%\"\r\n                >\r\n                  <el-option label=\"個\" value=\"個\" />\r\n                  <el-option label=\"箱\" value=\"箱\" />\r\n                  <el-option label=\"包\" value=\"包\" />\r\n                  <el-option label=\"套\" value=\"套\" />\r\n                  <el-option label=\"張\" value=\"張\" />\r\n                  <el-option label=\"公斤\" value=\"公斤\" />\r\n                  <el-option label=\"公尺\" value=\"公尺\" />\r\n                  <el-option label=\"瓶\" value=\"瓶\" />\r\n                </el-select>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"類別\" width=\"120\">\r\n              <template #default=\"{ row }\">\r\n                <el-select\r\n                  v-model=\"row.item_category\"\r\n                  placeholder=\"選擇類別\"\r\n                  filterable\r\n                  style=\"width: 100%\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"category in categories\"\r\n                    :key=\"category.category_code\"\r\n                    :label=\"category.category_name\"\r\n                    :value=\"category.category_code\"\r\n                  />\r\n                </el-select>\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"用途說明\" min-width=\"150\">\r\n              <template #default=\"{ row }\">\r\n                <el-input\r\n                  v-model=\"row.item_description\"\r\n                  placeholder=\"請說明用途\"\r\n                  type=\"textarea\"\r\n                  :rows=\"2\"\r\n                />\r\n              </template>\r\n            </el-table-column>\r\n            \r\n            <el-table-column label=\"操作\" width=\"80\" fixed=\"right\">\r\n              <template #default=\"{ $index }\">\r\n                <el-button\r\n                  type=\"danger\"\r\n                  :icon=\"Delete\"\r\n                  size=\"small\"\r\n                  @click=\"removeItem($index)\"\r\n                />\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n\r\n          <div v-if=\"formData.items.length === 0\" class=\"empty-items\">\r\n            <el-empty description=\"請添加請購項目\" :image-size=\"60\">\r\n              <el-button type=\"primary\" @click=\"addItem\">添加第一個項目</el-button>\r\n            </el-empty>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Form Actions -->\r\n        <div class=\"form-actions\">\r\n          <el-button @click=\"handleBack\">取消</el-button>\r\n          <el-button\r\n            type=\"info\"\r\n            :loading=\"submitting\"\r\n            @click=\"handleSaveDraft\"\r\n          >\r\n            保存草稿\r\n          </el-button>\r\n          <el-button\r\n            type=\"primary\"\r\n            :loading=\"submitting\"\r\n            @click=\"handleSubmit\"\r\n          >\r\n            提交審核\r\n          </el-button>\r\n        </div>\r\n      </el-form>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage, ElMessageBox, type FormInstance } from 'element-plus'\r\nimport { Plus, Delete } from '@element-plus/icons-vue'\r\nimport { PageHeader } from '@/components'\r\nimport { useRequisitionStore, useAuthStore } from '@/stores'\r\nimport { projectsApi } from '@/api'\r\nimport type { CreateRequisitionRequest } from '@/api/requisition'\r\n\r\ninterface RequisitionItem {\r\n  item_name: string\r\n  item_quantity: number\r\n  item_unit: string\r\n  item_specification?: string\r\n  item_description?: string\r\n  item_category?: string\r\n}\r\n\r\ninterface FormData {\r\n  usage_type: 'daily' | 'project'\r\n  project_id?: string\r\n  items: RequisitionItem[]\r\n  // 加急相關欄位\r\n  is_urgent: boolean\r\n  expected_delivery_date?: string\r\n  urgent_reason?: string\r\n}\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst requisitionStore = useRequisitionStore()\r\nconst authStore = useAuthStore()\r\n\r\n// Form ref\r\nconst formRef = ref<FormInstance>()\r\n\r\n// State\r\nconst submitting = ref(false)\r\nconst projects = ref<any[]>([])\r\nconst categories = ref<any[]>([\r\n  { category_code: 'office', category_name: '辦公用品' },\r\n  { category_code: 'electronic', category_name: '電子設備' },\r\n  { category_code: 'furniture', category_name: '辦公家具' },\r\n  { category_code: 'consumable', category_name: '耗材用品' },\r\n  { category_code: 'tool', category_name: '工具設備' },\r\n  { category_code: 'other', category_name: '其他' }\r\n])\r\n\r\n// Computed\r\nconst isEdit = computed(() => !!route.params.id)\r\nconst requisitionId = computed(() => route.params.id as string)\r\n\r\n// Form data\r\nconst formData = reactive<FormData>({\r\n  usage_type: 'daily',\r\n  items: [],\r\n  // 加急相關欄位\r\n  is_urgent: false,\r\n  expected_delivery_date: '',\r\n  urgent_reason: ''\r\n})\r\n\r\n// Form validation errors\r\nconst itemErrors = ref<Record<number, Record<string, string>>>({})\r\n\r\n// Form rules\r\nconst formRules = {\r\n  usage_type: [\r\n    { required: true, message: '請選擇用途類型', trigger: 'change' }\r\n  ],\r\n  project_id: [\r\n    {\r\n      required: true,\r\n      message: '請選擇專案編號',\r\n      trigger: 'change',\r\n      validator: (rule: any, value: any, callback: any) => {\r\n        if (formData.usage_type === 'project' && !value) {\r\n          callback(new Error('專案類型必須選擇專案編號'))\r\n        } else {\r\n          callback()\r\n        }\r\n      }\r\n    }\r\n  ],\r\n  expected_delivery_date: [\r\n    {\r\n      required: true,\r\n      message: '請選擇期望到貨日期',\r\n      trigger: 'change',\r\n      validator: (rule: any, value: any, callback: any) => {\r\n        if (formData.is_urgent && !value) {\r\n          callback(new Error('加急請購單必須填寫期望到貨日期'))\r\n        } else {\r\n          callback()\r\n        }\r\n      }\r\n    }\r\n  ],\r\n  urgent_reason: [\r\n    {\r\n      required: true,\r\n      message: '請說明加急原因',\r\n      trigger: 'blur',\r\n      validator: (rule: any, value: any, callback: any) => {\r\n        if (formData.is_urgent && !value?.trim()) {\r\n          callback(new Error('加急請購單必須說明加急原因'))\r\n        } else {\r\n          callback()\r\n        }\r\n      }\r\n    }\r\n  ]\r\n}\r\n\r\n// Methods\r\nconst getFieldError = (index: number, field: string) => {\r\n  return itemErrors.value[index]?.[field]\r\n}\r\n\r\n// 加急功能相關方法\r\nconst onUrgentChange = (isUrgent: boolean) => {\r\n  if (!isUrgent) {\r\n    // 取消加急時清空相關欄位\r\n    formData.expected_delivery_date = ''\r\n    formData.urgent_reason = ''\r\n  }\r\n}\r\n\r\nconst disabledDate = (time: Date) => {\r\n  // 禁用今天之前的日期\r\n  return time.getTime() < Date.now() - 8.64e7\r\n}\r\n\r\nconst validateItems = () => {\r\n  itemErrors.value = {}\r\n  let hasError = false\r\n\r\n  if (formData.items.length === 0) {\r\n    ElMessage.error('請至少添加一個請購項目')\r\n    return false\r\n  }\r\n\r\n  formData.items.forEach((item, index) => {\r\n    const errors: Record<string, string> = {}\r\n\r\n    if (!item.item_name?.trim()) {\r\n      errors.item_name = '項目名稱不能為空'\r\n      hasError = true\r\n    }\r\n\r\n    if (!item.item_quantity || item.item_quantity < 1) {\r\n      errors.item_quantity = '數量必須大於0'\r\n      hasError = true\r\n    }\r\n\r\n    if (Object.keys(errors).length > 0) {\r\n      itemErrors.value[index] = errors\r\n    }\r\n  })\r\n\r\n  if (hasError) {\r\n    ElMessage.error('請檢查項目信息填寫')\r\n  }\r\n\r\n  return !hasError\r\n}\r\n\r\nconst addItem = () => {\r\n  formData.items.push({\r\n    item_name: '',\r\n    item_quantity: 1,\r\n    item_unit: '個',\r\n    item_specification: '',\r\n    item_description: '',\r\n    item_category: ''\r\n  })\r\n}\r\n\r\nconst removeItem = (index: number) => {\r\n  formData.items.splice(index, 1)\r\n  // Clean up errors for removed item\r\n  delete itemErrors.value[index]\r\n}\r\n\r\nconst handleBack = () => {\r\n  router.go(-1)\r\n}\r\n\r\nconst handleSaveDraft = async () => {\r\n  if (!await formRef.value?.validate()) return\r\n  if (!validateItems()) return\r\n\r\n  try {\r\n    submitting.value = true\r\n    \r\n    const requestData: CreateRequisitionRequest = {\r\n      usage_type: formData.usage_type,\r\n      project_id: formData.project_id,\r\n      status: 'draft',  // CRITICAL FIX: Explicitly set draft status\r\n      items: formData.items.map(item => ({\r\n        item_name: item.item_name.trim(),\r\n        item_quantity: item.item_quantity,\r\n        item_unit: item.item_unit,\r\n        item_specification: item.item_specification?.trim(),\r\n        item_description: item.item_description?.trim(),\r\n        item_category: item.item_category\r\n      })),\r\n      // 加急相關欄位\r\n      is_urgent: formData.is_urgent,\r\n      expected_delivery_date: formData.is_urgent ? formData.expected_delivery_date : undefined,\r\n      urgent_reason: formData.is_urgent ? formData.urgent_reason : undefined\r\n    }\r\n\r\n    if (isEdit.value) {\r\n      await requisitionStore.updateRequisition(requisitionId.value, requestData)\r\n      ElMessage.success('請購單保存成功')\r\n    } else {\r\n      await requisitionStore.createRequisition(requestData)\r\n      ElMessage.success('請購單創建成功')\r\n    }\r\n    \r\n    router.push('/requisitions')\r\n  } catch (error) {\r\n    console.error('Save failed:', error)\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!await formRef.value?.validate()) return\r\n  if (!validateItems()) return\r\n\r\n  try {\r\n    const result = await ElMessageBox.confirm(\r\n      '提交後將無法修改，確定要提交審核嗎？',\r\n      '提交確認',\r\n      {\r\n        confirmButtonText: '確定提交',\r\n        cancelButtonText: '取消',\r\n        type: 'warning'\r\n      }\r\n    )\r\n\r\n    if (result === 'confirm') {\r\n      submitting.value = true\r\n      \r\n      if (isEdit.value) {\r\n        // For existing requisitions, first update then submit\r\n        const requestData: CreateRequisitionRequest = {\r\n          usage_type: formData.usage_type,\r\n          project_id: formData.project_id,\r\n          status: 'draft',  // Keep as draft for update\r\n          items: formData.items.map(item => ({\r\n            item_name: item.item_name.trim(),\r\n            item_quantity: item.item_quantity,\r\n            item_unit: item.item_unit,\r\n            item_specification: item.item_specification?.trim(),\r\n            item_description: item.item_description?.trim(),\r\n            item_category: item.item_category\r\n          })),\r\n          // 加急相關欄位\r\n          is_urgent: formData.is_urgent,\r\n          expected_delivery_date: formData.is_urgent ? formData.expected_delivery_date : undefined,\r\n          urgent_reason: formData.is_urgent ? formData.urgent_reason : undefined\r\n        }\r\n        await requisitionStore.updateRequisition(requisitionId.value, requestData)\r\n        await requisitionStore.submitRequisition(requisitionId.value)\r\n      } else {\r\n        // CRITICAL FIX: For new requisitions, create directly with submitted status\r\n        const requestData: CreateRequisitionRequest = {\r\n          usage_type: formData.usage_type,\r\n          project_id: formData.project_id,\r\n          status: 'submitted',  // CRITICAL FIX: Set to submitted status\r\n          items: formData.items.map(item => ({\r\n            item_name: item.item_name.trim(),\r\n            item_quantity: item.item_quantity,\r\n            item_unit: item.item_unit,\r\n            item_specification: item.item_specification?.trim(),\r\n            item_description: item.item_description?.trim(),\r\n            item_category: item.item_category\r\n          })),\r\n          // 加急相關欄位\r\n          is_urgent: formData.is_urgent,\r\n          expected_delivery_date: formData.is_urgent ? formData.expected_delivery_date : undefined,\r\n          urgent_reason: formData.is_urgent ? formData.urgent_reason : undefined\r\n        }\r\n        await requisitionStore.createRequisition(requestData)\r\n      }\r\n      \r\n      ElMessage.success('請購單已提交審核')\r\n      router.push('/requisitions')\r\n    }\r\n  } catch (error) {\r\n    if (error !== 'cancel') {\r\n      console.error('Submit failed:', error)\r\n    }\r\n  } finally {\r\n    submitting.value = false\r\n  }\r\n}\r\n\r\nconst fetchProjects = async () => {\r\n  try {\r\n    const response = await projectsApi.getActiveProjects()\r\n    projects.value = response\r\n  } catch (error) {\r\n    console.error('Failed to fetch projects:', error)\r\n  }\r\n}\r\n\r\nconst loadRequisition = async () => {\r\n  if (!isEdit.value) return\r\n\r\n  try {\r\n    const requisition = await requisitionStore.fetchRequisitionDetail(requisitionId.value)\r\n\r\n    // Populate form data\r\n    formData.usage_type = requisition.usage_type || 'daily'\r\n    formData.project_id = requisition.project_id\r\n    formData.is_urgent = requisition.is_urgent || false\r\n    formData.expected_delivery_date = requisition.expected_delivery_date || ''\r\n    formData.urgent_reason = requisition.urgent_reason || ''\r\n\r\n    // Map requisition items to form items\r\n    if (requisition.items && requisition.items.length > 0) {\r\n      formData.items = requisition.items.map((item: any) => ({\r\n        item_name: item.item_name || '',\r\n        item_quantity: item.item_quantity || 1,\r\n        item_unit: item.item_unit || '個',\r\n        item_specification: item.item_specification || '',\r\n        item_description: item.item_description || '',\r\n        item_category: item.item_category || ''\r\n      }))\r\n    } else {\r\n      // If no items, add one empty item\r\n      addItem()\r\n    }\r\n\r\n    ElMessage.success('請購單數據載入完成')\r\n  } catch (error) {\r\n    ElMessage.error('載入請購單失敗')\r\n    router.push('/requisitions')\r\n  }\r\n}\r\n\r\n// Initialize with one empty item for new requisitions\r\nonMounted(async () => {\r\n  await fetchProjects()\r\n  \r\n  if (isEdit.value) {\r\n    await loadRequisition()\r\n  } else {\r\n    addItem()\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.requisition-form {\r\n  .form-section {\r\n    margin-bottom: 32px;\r\n    \r\n    .section-title {\r\n      margin: 0 0 16px 0;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      color: #303133;\r\n      border-bottom: 2px solid #409eff;\r\n      padding-bottom: 8px;\r\n    }\r\n    \r\n    .section-header {\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 16px;\r\n    }\r\n  }\r\n  \r\n  .empty-items {\r\n    text-align: center;\r\n    padding: 40px;\r\n    border: 2px dashed #dcdfe6;\r\n    border-radius: 6px;\r\n    margin-top: 16px;\r\n  }\r\n  \r\n  .form-actions {\r\n    display: flex;\r\n    justify-content: center;\r\n    gap: 16px;\r\n    padding-top: 24px;\r\n    border-top: 1px solid #ebeef5;\r\n    margin-top: 32px;\r\n  }\r\n  \r\n  .field-error {\r\n    color: #f56c6c;\r\n    font-size: 12px;\r\n    margin-top: 4px;\r\n    line-height: 1;\r\n  }\r\n  \r\n  .is-error {\r\n    :deep(.el-input__inner) {\r\n      border-color: #f56c6c;\r\n    }\r\n    \r\n    :deep(.el-input-number .el-input__inner) {\r\n      border-color: #f56c6c;\r\n    }\r\n  }\r\n\r\n  /* 加急設定樣式 */\r\n  .urgent-details {\r\n    background: #fff2f0;\r\n    border: 1px solid #ffccc7;\r\n    border-radius: 6px;\r\n    padding: 16px;\r\n    margin-top: 16px;\r\n  }\r\n\r\n  .urgent-details .el-form-item__label {\r\n    color: #cf1322;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .urgent-checkbox .urgent-label {\r\n    color: #cf1322;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .urgent-date-picker :deep(.el-input__inner) {\r\n    border-color: #ff7875;\r\n  }\r\n\r\n  .urgent-date-picker :deep(.el-input__inner:focus) {\r\n    border-color: #cf1322;\r\n    box-shadow: 0 0 0 2px rgba(207, 19, 34, 0.2);\r\n  }\r\n\r\n  .urgent-reason-input :deep(.el-textarea__inner) {\r\n    border-color: #ff7875;\r\n  }\r\n\r\n  .urgent-reason-input :deep(.el-textarea__inner:focus) {\r\n    border-color: #cf1322;\r\n    box-shadow: 0 0 0 2px rgba(207, 19, 34, 0.2);\r\n  }\r\n}\r\n\r\n/* Responsive */\r\n@media (max-width: 768px) {\r\n  .requisition-form {\r\n    .section-header {\r\n      flex-direction: column;\r\n      align-items: flex-start;\r\n      gap: 12px;\r\n    }\r\n    \r\n    .form-actions {\r\n      flex-direction: column;\r\n      \r\n      .el-button {\r\n        width: 100%;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"],"names":["route","useRoute","router","useRouter","requisitionStore","useRequisitionStore","useAuthStore","formRef","ref","submitting","projects","categories","isEdit","computed","requisitionId","formData","reactive","itemErrors","formRules","rule","value","callback","getFieldError","index","field","_a","onUrgentChange","isUrgent","disabledDate","time","validateItems","hasError","ElMessage","item","errors","addItem","removeItem","handleBack","handleSaveDraft","requestData","_b","error","handleSubmit","ElMessageBox","fetchProjects","response","projectsApi","loadRequisition","requisition","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_unref","PageHeader","_withCtx","_component_el_form","_withModifiers","_createElementVNode","_hoisted_2","_cache","_component_el_row","_component_el_col","_component_el_form_item","_component_el_radio_group","$event","_component_el_radio","_createTextVNode","_createBlock","_component_el_select","_Fragment","_renderList","project","_component_el_checkbox","_component_el_date_picker","_component_el_input","_hoisted_5","_component_el_button","Plus","_component_el_table_column","row","_normalizeClass","$index","_component_el_input_number","_component_el_option","category","Delete","_component_el_empty"],"mappings":"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"}