import{d as Y,n as Z,y as ee,r as f,p,a1 as te,c as M,b as o,e as a,w as t,aP as P,q as D,ab as S,aA as A,X as z,m as ae,al as se,aS as oe,o as g,i as r,t as n,ac as B,ao as le,aJ as ne,aK as re,b5 as ue,aj as ie,a4 as de,av as ce,aw as _e,ak as pe,_ as ve}from"./index-61294aba.js";/* empty css                   *//* empty css                 *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css               *//* empty css                    *//* empty css                *//* empty css                             *//* empty css                  */const me={class:"project-detail"},fe={class:"page-header"},ge={class:"header-left"},be={class:"header-actions"},he={class:"content-wrapper"},we={class:"card-header"},ye={class:"budget-overview"},je={class:"budget-item"},Ee={class:"value"},ke={class:"budget-item"},qe={class:"budget-item"},Te={class:"budget-item"},Ce={class:"value"},De={class:"stat-item"},Re={class:"stat-value"},$e={class:"stat-item"},Ne={class:"stat-value"},xe={class:"stat-item"},Me={class:"stat-value"},Pe={class:"card-header"},Se=Y({__name:"Detail",setup(Ae){const b=Z(),j=ee(),E=f(!1),h=f(!1),l=f({}),w=f({}),v=f([]),I=p(()=>l.value.customer_name||l.value.customer_department||l.value.customer_contact||l.value.customer_phone||l.value.customer_address),k=p(()=>v.value.reduce((s,e)=>s+(e.total_amount||0),0)),q=p(()=>(l.value.budget||0)-k.value),R=p(()=>{const s=l.value.budget||0;return s?Math.min(100,Math.round(k.value/s*100)):0}),L=p(()=>q.value<0),V=p(()=>{const s=R.value;return s>=100?"exception":s>=90?"warning":"success"}),F=async()=>{E.value=!0;try{const s=b.params.id,e=await A.getProject(s);l.value=e}catch(s){console.error("Failed to fetch project:",s),z.error("載入專案資料失敗"),j.push("/projects")}finally{E.value=!1}},W=async()=>{try{const s=b.params.id,e=v.value.reduce((i,y)=>i+(y.total_amount||0),0);w.value={week_total:e,month_total:e,all_time_total:e}}catch(s){console.error("Failed to fetch statistics:",s)}},$=async()=>{h.value=!0;try{const s=b.params.id,e=await A.getProjectRequisitions(s);v.value=e.map(i=>({request_order_no:i.requisition_no,submit_date:i.requisition_date,requester_name:i.applicant_name,total_amount:i.total_amount,order_status:i.status,...i}))}catch(s){console.error("Failed to fetch requisitions:",s),z.error("獲取請購單失敗")}finally{h.value=!1}},K=()=>{j.push(`/projects/${b.params.id}/edit`)},O=s=>{j.push(`/requisitions/${s.request_order_no}`)},T=s=>s?new Date(s).toLocaleDateString("zh-TW"):"-",c=s=>s.toLocaleString("zh-TW"),G=s=>({draft:"草稿",pending:"待審核",reviewed:"已審核",approved:"已核准",rejected:"已拒絕",cancelled:"已取消",completed:"已完成"})[s]||s,J=s=>({draft:"info",pending:"warning",reviewed:"primary",approved:"success",rejected:"danger",cancelled:"info",completed:"success"})[s]||"info";return te(async()=>{await F(),await $(),W()}),(s,e)=>{const i=ae,y=le,d=ne,N=re,m=se,U=ue,C=ie,X=de,_=ce,H=_e,Q=pe,x=oe;return g(),M("div",me,[o("div",fe,[o("div",ge,[a(i,{icon:"ArrowLeft",circle:"",onClick:e[0]||(e[0]=u=>s.$router.back())}),e[1]||(e[1]=o("h1",null,"專案詳情",-1))]),o("div",be,[a(i,{type:"primary",icon:"Edit",onClick:K},{default:t(()=>[...e[2]||(e[2]=[r("編輯",-1)])]),_:1})])]),P((g(),M("div",he,[a(m,{class:"info-card"},{header:t(()=>[o("div",we,[e[3]||(e[3]=o("span",null,"基本資訊",-1)),a(y,{type:l.value.project_status==="ongoing"?"success":"info"},{default:t(()=>[r(n(l.value.project_status==="ongoing"?"進行中":"已完成"),1)]),_:1},8,["type"])])]),default:t(()=>[a(N,{column:2,border:""},{default:t(()=>[a(d,{label:"專案代碼"},{default:t(()=>[r(n(l.value.project_code||"-"),1)]),_:1}),a(d,{label:"專案名稱"},{default:t(()=>[r(n(l.value.project_name),1)]),_:1}),a(d,{label:"專案描述",span:2},{default:t(()=>[r(n(l.value.description||"-"),1)]),_:1}),a(d,{label:"開始日期"},{default:t(()=>[r(n(T(l.value.start_date)),1)]),_:1}),a(d,{label:"結束日期"},{default:t(()=>[r(n(T(l.value.end_date)),1)]),_:1}),a(d,{label:"專案負責人"},{default:t(()=>{var u;return[r(n(((u=l.value.manager)==null?void 0:u.chinese_name)||"-"),1)]}),_:1}),a(d,{label:"負責人部門"},{default:t(()=>{var u;return[r(n(((u=l.value.manager)==null?void 0:u.department)||"-"),1)]}),_:1})]),_:1})]),_:1}),a(m,{class:"budget-card"},{header:t(()=>[...e[4]||(e[4]=[o("span",null,"預算與花費",-1)])]),default:t(()=>[o("div",ye,[o("div",je,[e[5]||(e[5]=o("div",{class:"label"},"專案預算",-1)),o("div",Ee,"NT$ "+n(c(l.value.budget||0)),1)]),o("div",ke,[e[6]||(e[6]=o("div",{class:"label"},"已花費金額",-1)),o("div",{class:B(["value",{"text-danger":L.value}])}," NT$ "+n(c(k.value)),3)]),o("div",qe,[e[7]||(e[7]=o("div",{class:"label"},"剩餘預算",-1)),o("div",{class:B(["value",{"text-danger":q.value<0}])}," NT$ "+n(c(q.value)),3)]),o("div",Te,[e[8]||(e[8]=o("div",{class:"label"},"預算使用率",-1)),o("div",Ce,[a(U,{percentage:R.value,status:V.value,"stroke-width":20},null,8,["percentage","status"])])])])]),_:1}),a(m,{class:"statistics-card"},{header:t(()=>[...e[9]||(e[9]=[o("span",null,"花費統計",-1)])]),default:t(()=>[a(X,{gutter:20},{default:t(()=>[a(C,{span:8},{default:t(()=>[o("div",De,[e[10]||(e[10]=o("div",{class:"stat-label"},"過去一週花費",-1)),o("div",Re,"NT$ "+n(c(w.value.week_total||0)),1)])]),_:1}),a(C,{span:8},{default:t(()=>[o("div",$e,[e[11]||(e[11]=o("div",{class:"stat-label"},"過去一個月花費",-1)),o("div",Ne,"NT$ "+n(c(w.value.month_total||0)),1)])]),_:1}),a(C,{span:8},{default:t(()=>[o("div",xe,[e[12]||(e[12]=o("div",{class:"stat-label"},"專案總花費",-1)),o("div",Me,"NT$ "+n(c(w.value.all_time_total||0)),1)])]),_:1})]),_:1})]),_:1}),I.value?(g(),D(m,{key:0,class:"customer-card"},{header:t(()=>[...e[13]||(e[13]=[o("span",null,"客戶資訊",-1)])]),default:t(()=>[a(N,{column:2,border:""},{default:t(()=>[a(d,{label:"客戶名稱"},{default:t(()=>[r(n(l.value.customer_name||"-"),1)]),_:1}),a(d,{label:"客戶部門"},{default:t(()=>[r(n(l.value.customer_department||"-"),1)]),_:1}),a(d,{label:"聯絡人"},{default:t(()=>[r(n(l.value.customer_contact||"-"),1)]),_:1}),a(d,{label:"聯絡電話"},{default:t(()=>[r(n(l.value.customer_phone||"-"),1)]),_:1}),a(d,{label:"客戶地址",span:2},{default:t(()=>[r(n(l.value.customer_address||"-"),1)]),_:1})]),_:1})]),_:1})):S("",!0),a(m,{class:"requisitions-card"},{header:t(()=>[o("div",Pe,[e[15]||(e[15]=o("span",null,"相關請購單",-1)),a(i,{size:"small",icon:"Refresh",onClick:$},{default:t(()=>[...e[14]||(e[14]=[r(" 重新整理 ",-1)])]),_:1})])]),default:t(()=>[P((g(),D(H,{data:v.value},{default:t(()=>[a(_,{prop:"request_order_no",label:"請購單號",width:"150"}),a(_,{prop:"submit_date",label:"提交日期",width:"120"},{default:t(u=>[r(n(T(u.row.submit_date)),1)]),_:1}),a(_,{prop:"requester_name",label:"請購人",width:"100"}),a(_,{prop:"total_amount",label:"金額",width:"120",align:"right"},{default:t(u=>[r(" NT$ "+n(c(u.row.total_amount||0)),1)]),_:1}),a(_,{prop:"order_status",label:"狀態",width:"100"},{default:t(u=>[a(y,{size:"small",type:J(u.row.order_status)},{default:t(()=>[r(n(G(u.row.order_status)),1)]),_:2},1032,["type"])]),_:1}),a(_,{label:"操作"},{default:t(u=>[a(i,{size:"small",type:"primary",link:"",onClick:ze=>O(u.row)},{default:t(()=>[...e[16]||(e[16]=[r(" 查看 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[x,h.value]]),!v.value.length&&!h.value?(g(),D(Q,{key:0,description:"暫無相關請購單"})):S("",!0)]),_:1})])),[[x,E.value]])])}}});const He=ve(Se,[["__scopeId","data-v-a404a1e2"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/projects/Detail.vue"]]);export{He as default};
//# sourceMappingURL=Detail-653ef24f.js.map
