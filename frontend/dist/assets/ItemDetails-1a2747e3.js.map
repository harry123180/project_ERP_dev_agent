{"version":3,"mappings":"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","names":["route","useRoute","router","useRouter","loading","ref","historyLoading","activeTab","itemDetails","historyData","reactive","itemKey","loadItemDetails","inventoryApi","__vitePreload","n","data","error","ElMessage","loadHistory","page","perPage","refreshData","goBack","handleTabChange","tabName","handleHistoryPageChange","_a","handleHistorySizeChange","size","formatDate","dateString","formatDateTime","getQuantityTagType","quantity","getMovementSubtypeText","subtype","viewPO","poNumber","viewBatchDetails","batchId","viewBatchHistory","viewStorageDetails","storageId","exportHistory","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_card","_withCtx","_hoisted_3","_hoisted_4","_hoisted_5","_toDisplayString","_b","_hoisted_6","_createCommentVNode","_component_el_button","_component_el_icon","_unref","Refresh","ArrowLeft","_hoisted_8","_component_el_row","_component_el_col","_hoisted_9","_hoisted_10","_cache","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_c","_component_el_tabs","$event","_component_el_tab_pane","_hoisted_19","_component_el_descriptions","_component_el_descriptions_item","_createTextVNode","_component_el_tag","_hoisted_20","_withDirectives","_createBlock","_component_el_table","_component_el_table_column","_component_el_link","row","View","Clock","_hoisted_21","_hoisted_22","_hoisted_23","Download","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_component_el_pagination"],"sources":["../../src/views/inventory/ItemDetails.vue"],"sourcesContent":["<template>\r\n  <div class=\"inventory-item-details\">\r\n    <!-- Header with basic item info -->\r\n    <div class=\"header-section\">\r\n      <el-card>\r\n        <template #header>\r\n          <div class=\"header-content\">\r\n            <div class=\"item-info\">\r\n              <h2 class=\"item-name\">{{ itemDetails?.item_name }}</h2>\r\n              <p class=\"item-spec\" v-if=\"itemDetails?.item_specification\">\r\n                {{ itemDetails.item_specification }}\r\n              </p>\r\n            </div>\r\n            <div class=\"actions\">\r\n              <el-button @click=\"refreshData\" :loading=\"loading\">\r\n                <el-icon><Refresh /></el-icon>\r\n                重新整理\r\n              </el-button>\r\n              <el-button @click=\"goBack\">\r\n                <el-icon><ArrowLeft /></el-icon>\r\n                返回\r\n              </el-button>\r\n            </div>\r\n          </div>\r\n        </template>\r\n        \r\n        <div class=\"summary-cards\">\r\n          <el-row :gutter=\"20\">\r\n            <el-col :span=\"6\">\r\n              <div class=\"summary-card\">\r\n                <div class=\"summary-value\">{{ itemDetails?.total_quantity || 0 }}</div>\r\n                <div class=\"summary-label\">總庫存數量</div>\r\n                <div class=\"summary-unit\">{{ itemDetails?.unit }}</div>\r\n              </div>\r\n            </el-col>\r\n            <el-col :span=\"6\">\r\n              <div class=\"summary-card\">\r\n                <div class=\"summary-value\">{{ itemDetails?.batch_count || 0 }}</div>\r\n                <div class=\"summary-label\">批次數量</div>\r\n              </div>\r\n            </el-col>\r\n            <el-col :span=\"6\">\r\n              <div class=\"summary-card\">\r\n                <div class=\"summary-value\">{{ itemDetails?.storage_distribution?.length || 0 }}</div>\r\n                <div class=\"summary-label\">儲存位置</div>\r\n              </div>\r\n            </el-col>\r\n            <el-col :span=\"6\">\r\n              <div class=\"summary-card\">\r\n                <div class=\"summary-value\">\r\n                  {{ formatDate(itemDetails?.batches?.[0]?.received_date) || '-' }}\r\n                </div>\r\n                <div class=\"summary-label\">最近收貨日期</div>\r\n              </div>\r\n            </el-col>\r\n          </el-row>\r\n        </div>\r\n      </el-card>\r\n    </div>\r\n\r\n    <!-- Tabs for detailed information -->\r\n    <div class=\"details-section\">\r\n      <el-card>\r\n        <el-tabs v-model=\"activeTab\" @tab-change=\"handleTabChange\">\r\n          <!-- Basic Information Tab -->\r\n          <el-tab-pane label=\"基本資訊\" name=\"basic\">\r\n            <div class=\"basic-info\">\r\n              <el-descriptions :column=\"2\" border>\r\n                <el-descriptions-item label=\"物料名稱\">\r\n                  {{ itemDetails?.item_name }}\r\n                </el-descriptions-item>\r\n                <el-descriptions-item label=\"規格說明\">\r\n                  {{ itemDetails?.item_specification || '-' }}\r\n                </el-descriptions-item>\r\n                <el-descriptions-item label=\"單位\">\r\n                  {{ itemDetails?.unit }}\r\n                </el-descriptions-item>\r\n                <el-descriptions-item label=\"總庫存數量\">\r\n                  <el-tag :type=\"getQuantityTagType(itemDetails?.total_quantity)\">\r\n                    {{ itemDetails?.total_quantity }} {{ itemDetails?.unit }}\r\n                  </el-tag>\r\n                </el-descriptions-item>\r\n                <el-descriptions-item label=\"批次總數\">\r\n                  {{ itemDetails?.batch_count }}\r\n                </el-descriptions-item>\r\n                <el-descriptions-item label=\"儲存位置總數\">\r\n                  {{ itemDetails?.storage_distribution?.length || 0 }}\r\n                </el-descriptions-item>\r\n              </el-descriptions>\r\n            </div>\r\n          </el-tab-pane>\r\n\r\n          <!-- Batch Breakdown Tab -->\r\n          <el-tab-pane label=\"批次分佈\" name=\"batches\">\r\n            <div class=\"batches-info\">\r\n              <el-table :data=\"itemDetails?.batches\" v-loading=\"loading\" stripe>\r\n                <el-table-column prop=\"batch_id\" label=\"批次ID\" width=\"100\" />\r\n                <el-table-column prop=\"source_po_number\" label=\"來源採購單\" width=\"150\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-link type=\"primary\" @click=\"viewPO(row.source_po_number)\">\r\n                      {{ row.source_po_number }}\r\n                    </el-link>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"current_quantity\" label=\"目前數量\" width=\"120\" align=\"right\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag :type=\"getQuantityTagType(row.current_quantity)\" size=\"small\">\r\n                      {{ row.current_quantity }}\r\n                    </el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"original_quantity\" label=\"原始數量\" width=\"120\" align=\"right\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.original_quantity }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"received_date\" label=\"收貨日期\" width=\"120\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ formatDate(row.received_date) }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"receiver_name\" label=\"收貨人\" width=\"100\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.receiver_name }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"batch_status\" label=\"狀態\" width=\"100\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag \r\n                      :type=\"row.batch_status === 'active' ? 'success' : 'info'\" \r\n                      size=\"small\"\r\n                    >\r\n                      {{ row.batch_status === 'active' ? '正常' : '已耗盡' }}\r\n                    </el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"操作\" width=\"150\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-button size=\"small\" @click=\"viewBatchDetails(row.batch_id)\">\r\n                      <el-icon><View /></el-icon>\r\n                      詳情\r\n                    </el-button>\r\n                    <el-button size=\"small\" @click=\"viewBatchHistory(row.batch_id)\">\r\n                      <el-icon><Clock /></el-icon>\r\n                      履歷\r\n                    </el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n          </el-tab-pane>\r\n\r\n          <!-- Storage Distribution Tab -->\r\n          <el-tab-pane label=\"儲存分佈\" name=\"storage\">\r\n            <div class=\"storage-info\">\r\n              <el-table :data=\"itemDetails?.storage_distribution\" v-loading=\"loading\" stripe>\r\n                <el-table-column prop=\"storage_id\" label=\"儲存位置\" width=\"200\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag type=\"info\" size=\"small\">{{ row.storage_id }}</el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"位置描述\" width=\"200\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.area_code }}-{{ row.shelf_code }}-第{{ row.floor_level }}層\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"quantity\" label=\"數量\" width=\"120\" align=\"right\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag :type=\"getQuantityTagType(row.quantity)\" size=\"small\">\r\n                      {{ row.quantity }} {{ itemDetails?.unit }}\r\n                    </el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"佔比\" width=\"120\" align=\"right\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ ((row.quantity / itemDetails?.total_quantity) * 100).toFixed(1) }}%\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"操作\" width=\"150\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-button size=\"small\" @click=\"viewStorageDetails(row.storage_id)\">\r\n                      <el-icon><View /></el-icon>\r\n                      查看\r\n                    </el-button>\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n            </div>\r\n          </el-tab-pane>\r\n\r\n          <!-- Movement History Tab -->\r\n          <el-tab-pane label=\"異動履歷\" name=\"history\">\r\n            <div class=\"history-info\">\r\n              <div class=\"history-controls\">\r\n                <el-button @click=\"loadHistory\" :loading=\"historyLoading\">\r\n                  <el-icon><Refresh /></el-icon>\r\n                  重新載入\r\n                </el-button>\r\n                <el-button @click=\"exportHistory\">\r\n                  <el-icon><Download /></el-icon>\r\n                  匯出履歷\r\n                </el-button>\r\n              </div>\r\n              \r\n              <el-table :data=\"historyData.movements\" v-loading=\"historyLoading\" stripe>\r\n                <el-table-column prop=\"movement_date\" label=\"異動時間\" width=\"160\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ formatDateTime(row.movement_date) }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"movement_type\" label=\"異動類型\" width=\"100\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-tag \r\n                      :type=\"row.movement_type === 'in' ? 'success' : 'warning'\" \r\n                      size=\"small\"\r\n                    >\r\n                      {{ row.movement_type === 'in' ? '入庫' : '出庫' }}\r\n                    </el-tag>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"movement_subtype\" label=\"異動子類型\" width=\"120\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ getMovementSubtypeText(row.movement_subtype) }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"quantity\" label=\"數量\" width=\"100\" align=\"right\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.quantity }}\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column label=\"儲存位置\" width=\"200\">\r\n                  <template #default=\"{ row }\">\r\n                    <div v-if=\"row.from_storage_id && row.to_storage_id\">\r\n                      {{ row.from_storage_id }} → {{ row.to_storage_id }}\r\n                    </div>\r\n                    <div v-else-if=\"row.to_storage_id\">\r\n                      入庫至 {{ row.to_storage_id }}\r\n                    </div>\r\n                    <div v-else-if=\"row.from_storage_id\">\r\n                      從 {{ row.from_storage_id }} 出庫\r\n                    </div>\r\n                    <div v-else>-</div>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"operator.chinese_name\" label=\"操作人員\" width=\"100\" />\r\n                <el-table-column prop=\"reference_number\" label=\"參考單號\" width=\"150\">\r\n                  <template #default=\"{ row }\">\r\n                    <el-link v-if=\"row.reference_number\" type=\"primary\">\r\n                      {{ row.reference_number }}\r\n                    </el-link>\r\n                    <span v-else>-</span>\r\n                  </template>\r\n                </el-table-column>\r\n                <el-table-column prop=\"notes\" label=\"備註\" min-width=\"200\">\r\n                  <template #default=\"{ row }\">\r\n                    {{ row.notes || '-' }}\r\n                  </template>\r\n                </el-table-column>\r\n              </el-table>\r\n              \r\n              <!-- Pagination -->\r\n              <div class=\"pagination-wrapper\" v-if=\"historyData.pagination\">\r\n                <el-pagination\r\n                  v-model:current-page=\"historyData.pagination.page\"\r\n                  v-model:page-size=\"historyData.pagination.per_page\"\r\n                  :page-sizes=\"[10, 20, 50, 100]\"\r\n                  :total=\"historyData.pagination.total\"\r\n                  layout=\"total, sizes, prev, pager, next, jumper\"\r\n                  @size-change=\"handleHistorySizeChange\"\r\n                  @current-change=\"handleHistoryPageChange\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </el-tab-pane>\r\n        </el-tabs>\r\n      </el-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { \r\n  Refresh, ArrowLeft, View, Clock, Download \r\n} from '@element-plus/icons-vue'\r\n\r\n// Router\r\nconst route = useRoute()\r\nconst router = useRouter()\r\n\r\n// Reactive data\r\nconst loading = ref(false)\r\nconst historyLoading = ref(false)\r\nconst activeTab = ref('basic')\r\nconst itemDetails = ref<any>(null)\r\nconst historyData = reactive<any>({\r\n  movements: [],\r\n  pagination: null\r\n})\r\n\r\n// Props from route\r\nconst itemKey = route.params.itemKey as string\r\n\r\n// Methods\r\nconst loadItemDetails = async () => {\r\n  try {\r\n    loading.value = true\r\n    // Use axios API instance for consistent authentication\r\n    const { inventoryApi } = await import('@/api')\r\n    const data = await inventoryApi.getInventoryItemDetails(itemKey)\r\n    itemDetails.value = data\r\n    \r\n  } catch (error) {\r\n    console.error('Error loading item details:', error)\r\n    ElMessage.error('載入物料詳情失敗')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst loadHistory = async (page: number = 1, perPage: number = 20) => {\r\n  try {\r\n    historyLoading.value = true\r\n    // Use axios API instance for consistent authentication\r\n    const { inventoryApi } = await import('@/api')\r\n    const data = await inventoryApi.getInventoryItemHistory(itemKey, page, perPage)\r\n    historyData.movements = data.movements\r\n    historyData.pagination = data.pagination\r\n    \r\n  } catch (error) {\r\n    console.error('Error loading item history:', error)\r\n    ElMessage.error('載入異動履歷失敗')\r\n  } finally {\r\n    historyLoading.value = false\r\n  }\r\n}\r\n\r\nconst refreshData = () => {\r\n  loadItemDetails()\r\n  if (activeTab.value === 'history') {\r\n    loadHistory()\r\n  }\r\n}\r\n\r\nconst goBack = () => {\r\n  router.back()\r\n}\r\n\r\nconst handleTabChange = (tabName: string) => {\r\n  if (tabName === 'history' && historyData.movements.length === 0) {\r\n    loadHistory()\r\n  }\r\n}\r\n\r\nconst handleHistoryPageChange = (page: number) => {\r\n  loadHistory(page, historyData.pagination?.per_page || 20)\r\n}\r\n\r\nconst handleHistorySizeChange = (size: number) => {\r\n  loadHistory(1, size)\r\n}\r\n\r\n// Helper methods\r\nconst formatDate = (dateString: string) => {\r\n  if (!dateString) return '-'\r\n  return new Date(dateString).toLocaleDateString('zh-TW')\r\n}\r\n\r\nconst formatDateTime = (dateString: string) => {\r\n  if (!dateString) return '-'\r\n  return new Date(dateString).toLocaleString('zh-TW')\r\n}\r\n\r\nconst getQuantityTagType = (quantity: number) => {\r\n  if (!quantity || quantity <= 0) return 'danger'\r\n  if (quantity <= 10) return 'warning'\r\n  return 'success'\r\n}\r\n\r\nconst getMovementSubtypeText = (subtype: string) => {\r\n  const subtypeMap: Record<string, string> = {\r\n    'receiving': '收貨入庫',\r\n    'issue': '領用出庫',\r\n    'transfer': '庫位轉移',\r\n    'adjustment': '盤點調整'\r\n  }\r\n  return subtypeMap[subtype] || subtype\r\n}\r\n\r\nconst viewPO = (poNumber: string) => {\r\n  ElMessage.info(`檢視採購單: ${poNumber}`)\r\n}\r\n\r\nconst viewBatchDetails = (batchId: number) => {\r\n  ElMessage.info(`檢視批次詳情: ${batchId}`)\r\n}\r\n\r\nconst viewBatchHistory = (batchId: number) => {\r\n  ElMessage.info(`檢視批次履歷: ${batchId}`)\r\n}\r\n\r\nconst viewStorageDetails = (storageId: string) => {\r\n  ElMessage.info(`檢視儲存位置: ${storageId}`)\r\n}\r\n\r\nconst exportHistory = () => {\r\n  ElMessage.info('匯出履歷功能開發中')\r\n}\r\n\r\n// Initialize\r\nonMounted(() => {\r\n  if (!itemKey) {\r\n    ElMessage.error('無效的物料識別碼')\r\n    router.back()\r\n    return\r\n  }\r\n  \r\n  loadItemDetails()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.inventory-item-details {\r\n  padding: 20px;\r\n}\r\n\r\n.header-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.header-content {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.item-info .item-name {\r\n  margin: 0;\r\n  color: #303133;\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n}\r\n\r\n.item-info .item-spec {\r\n  margin: 5px 0 0;\r\n  color: #909399;\r\n  font-size: 14px;\r\n}\r\n\r\n.summary-cards {\r\n  margin-top: 20px;\r\n}\r\n\r\n.summary-card {\r\n  text-align: center;\r\n  padding: 20px;\r\n  border: 1px solid #EBEEF5;\r\n  border-radius: 4px;\r\n  background: #FAFAFA;\r\n}\r\n\r\n.summary-value {\r\n  font-size: 28px;\r\n  font-weight: bold;\r\n  color: #409EFF;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.summary-label {\r\n  font-size: 14px;\r\n  color: #606266;\r\n  margin-bottom: 4px;\r\n}\r\n\r\n.summary-unit {\r\n  font-size: 12px;\r\n  color: #909399;\r\n}\r\n\r\n.details-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.basic-info {\r\n  padding: 20px;\r\n}\r\n\r\n.history-controls {\r\n  margin-bottom: 20px;\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.pagination-wrapper {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.batches-info, .storage-info, .history-info {\r\n  padding: 20px;\r\n}\r\n\r\n/* Responsive adjustments */\r\n@media (max-width: 768px) {\r\n  .summary-cards .el-col {\r\n    margin-bottom: 15px;\r\n  }\r\n  \r\n  .header-content {\r\n    flex-direction: column;\r\n    align-items: flex-start;\r\n    gap: 15px;\r\n  }\r\n}\r\n</style>"],"file":"assets/ItemDetails-1a2747e3.js"}