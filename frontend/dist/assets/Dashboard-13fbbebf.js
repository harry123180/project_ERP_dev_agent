import{d as ue,r as _,a as pe,p as U,a1 as _e,c as y,b as t,e as l,w as o,q as C,ab as V,aN as O,X as b,al as me,o as c,F as q,s as B,t as n,g as A,a9 as ve,i as w,ap as he,ay as fe,ac as P,C as ge,aP as ye,br as be,a0 as j,ah as we,ai as De,k as Ee,au as xe,I as ke,m as Me,E as Ce,aO as Se,ak as Ie,b6 as Le,av as Te,ao as $e,aw as Ve,bs as Ae,_ as Re}from"./index-61294aba.js";/* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                   *//* empty css                 *//* empty css                *//* empty css                 *//* empty css                     *//* empty css                  *//* empty css                             *//* empty css                 *//* empty css                  */const Ne={class:"invoice-management"},ze={class:"supplier-option"},Fe={class:"supplier-name"},Ye={class:"supplier-details"},Ue={key:0,class:"date-range-info"},Oe={class:"card-header"},qe={class:"header-actions"},Be={class:"result-summary"},Pe={key:1,class:"results-container"},je=["onClick"],We={class:"po-info"},Ge={class:"po-number"},Ke={class:"po-date"},Xe={class:"po-amount"},He={class:"amount-main"},Je={class:"amount-details"},Qe={class:"po-toggle"},Ze={class:"po-details"},et={class:"po-info-grid"},tt={class:"info-row"},at={class:"info-row"},st={class:"info-row"},lt={class:"info-row"},ot={class:"items-section"},nt={key:0,class:"notes-section"},rt=ue({__name:"Dashboard",setup(it){const k=_(),r=pe({supplierId:"",invoiceMonth:""}),M=_([]),E=_(!1),S=_(!1),I=_(!1),D=_(!1),i=_([]),p=_([]),h=_({startDate:"",endDate:"",paymentDays:0}),W=U(()=>r.supplierId&&r.invoiceMonth),G=U(()=>i.value.reduce((a,e)=>a+(e.grand_total_int||0),0)),K=async a=>{if(!a){R();return}E.value=!0;try{const e=await O.getSuppliers({search:a});M.value=e.items||[]}catch(e){console.error("搜尋供應商失敗:",e),b.error("搜尋供應商失敗")}finally{E.value=!1}},R=async()=>{E.value=!0;try{M.value=await O.getActiveSuppliers()}catch(a){console.error("載入供應商失敗:",a),b.error("載入供應商失敗")}finally{E.value=!1}},X=()=>{i.value=[],p.value=[],D.value=!1,h.value={startDate:"",endDate:"",paymentDays:0}},H=async()=>{var e,f,u;if(!(!k.value||!await k.value.validate().catch(()=>!1))){S.value=!0,p.value=[];try{const d=await j.searchInvoiceManagement({supplier_id:r.supplierId,invoice_month:r.invoiceMonth});i.value=d.purchase_orders||[],h.value={startDate:((e=d.search_period)==null?void 0:e.start_date)||"",endDate:((f=d.search_period)==null?void 0:f.end_date)||"",paymentDays:((u=d.search_period)==null?void 0:u.payment_days)||0},D.value=!0,i.value.length===0?b.info("未找到符合條件的採購記錄"):b.success(`找到 ${i.value.length} 筆採購記錄`)}catch(d){console.error("搜尋失敗:",d),b.error("搜尋採購記錄失敗，請檢查網路連線"),i.value=[],D.value=!0}finally{S.value=!1}}},J=()=>{var a;r.supplierId="",r.invoiceMonth="",i.value=[],p.value=[],D.value=!1,h.value={startDate:"",endDate:"",paymentDays:0},(a=k.value)==null||a.clearValidate()},Q=a=>{const e=p.value.indexOf(a);e>-1?p.value.splice(e,1):p.value.push(a)},Z=async()=>{var a;if(i.value.length!==0){I.value=!0;try{const e=await j.exportInvoiceManagement({supplier_id:r.supplierId,invoice_month:r.invoiceMonth,search_results:i.value.map(m=>m.purchase_order_no)}),f=window.URL.createObjectURL(e),u=document.createElement("a");u.href=f;const L=`請款管理-${((a=M.value.find(m=>m.supplier_id===r.supplierId))==null?void 0:a.supplier_name_zh)||r.supplierId}-${r.invoiceMonth}.xlsx`;u.download=L,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(f),b.success("Excel 檔案下載完成")}catch(e){console.error("匯出失敗:",e),b.error("匯出 Excel 失敗，請稍後重試")}finally{I.value=!1}}},ee=a=>a?new Date(a).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):"無",te=a=>({pending:"待處理",confirmed:"已確認",order_created:"已建單",outputted:"已輸出",purchased:"已採購",shipped:"已出貨",cancelled:"已取消"})[a]||a,ae=a=>!a||a.trim()===""?"未知":{active:"進行中",cancelled:"已取消",completed:"已完成"}[a]||a,se=a=>!a||a.trim()===""?"info":{active:"primary",cancelled:"danger",completed:"success"}[a]||"info";return _e(()=>{R()}),(a,e)=>{const f=we,u=De,d=Ee,L=xe,m=ke,T=Me,le=Ce,oe=Se,N=me,ne=Ie,re=Le,g=Te,ie=$e,de=Ve,ce=Ae;return c(),y("div",Ne,[e[12]||(e[12]=t("div",{class:"page-header"},[t("h1",null,"請款管理"),t("p",{class:"subtitle"},"智能請款單查核系統")],-1)),l(N,{class:"search-card",shadow:"never"},{header:o(()=>[...e[2]||(e[2]=[t("div",{class:"card-header"},[t("span",{class:"header-title"},"查詢條件")],-1)])]),default:o(()=>[l(le,{model:r,ref_key:"searchFormRef",ref:k,inline:!0,class:"search-form"},{default:o(()=>[l(d,{label:"供應商",prop:"supplierId",rules:[{required:!0,message:"請選擇供應商",trigger:"change"}]},{default:o(()=>[l(u,{modelValue:r.supplierId,"onUpdate:modelValue":e[0]||(e[0]=s=>r.supplierId=s),placeholder:"請選擇供應商",filterable:"",remote:"","remote-method":K,loading:E.value,style:{width:"280px"},clearable:"",onChange:X},{default:o(()=>[(c(!0),y(q,null,B(M.value,s=>(c(),C(f,{key:s.supplier_id,label:`${s.supplier_name_zh} (${s.supplier_id})`,value:s.supplier_id},{default:o(()=>[t("div",ze,[t("div",Fe,n(s.supplier_name_zh),1),t("div",Ye,n(s.supplier_id)+" | "+n(s.supplier_region==="domestic"?"國內":"國外"),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(d,{label:"請款月份",prop:"invoiceMonth",rules:[{required:!0,message:"請選擇請款月份",trigger:"change"}]},{default:o(()=>[l(L,{modelValue:r.invoiceMonth,"onUpdate:modelValue":e[1]||(e[1]=s=>r.invoiceMonth=s),type:"month",placeholder:"選擇請款月份",format:"YYYY年MM月","value-format":"YYYY-MM",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(d,null,{default:o(()=>[l(T,{type:"primary",onClick:H,disabled:!W.value,loading:S.value},{default:o(()=>[l(m,null,{default:o(()=>[l(A(ve))]),_:1}),e[3]||(e[3]=w(" 搜尋 ",-1))]),_:1},8,["disabled","loading"]),l(T,{onClick:J},{default:o(()=>[l(m,null,{default:o(()=>[l(A(he))]),_:1}),e[4]||(e[4]=w(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"]),h.value.startDate?(c(),y("div",Ue,[l(oe,{title:`搜尋範圍：${h.value.startDate} ~ ${h.value.endDate} (付款條件：${h.value.paymentDays}天)`,type:"info","show-icon":"",closable:!1},null,8,["title"])])):V("",!0)]),_:1}),i.value.length>0||D.value?(c(),C(N,{key:0,class:"results-card",shadow:"never"},{header:o(()=>[t("div",Oe,[e[6]||(e[6]=t("span",{class:"header-title"},"查核結果",-1)),t("div",qe,[t("span",Be," 共找到 "+n(i.value.length)+" 筆採購記錄，總金額：NT$ "+n(G.value.toLocaleString()),1),l(T,{type:"success",onClick:Z,disabled:i.value.length===0,loading:I.value},{default:o(()=>[l(m,null,{default:o(()=>[l(A(fe))]),_:1}),e[5]||(e[5]=w(" 匯出 Excel ",-1))]),_:1},8,["disabled","loading"])])])]),default:o(()=>[D.value&&i.value.length===0?(c(),C(ne,{key:0,description:"未找到符合條件的採購記錄","image-size":120})):(c(),y("div",Pe,[(c(!0),y(q,null,B(i.value,s=>{var z,F,Y;return c(),y("div",{key:s.purchase_order_no,class:P(["po-card",{expanded:p.value.includes(s.purchase_order_no)}])},[t("div",{class:"po-header",onClick:$=>Q(s.purchase_order_no)},[t("div",We,[t("div",Ge,n(s.purchase_order_no),1),t("div",Ke,n(ee(s.order_date)),1),t("div",{class:P(["po-status",`status-${s.purchase_status}`])},n(te(s.purchase_status)),3)]),t("div",Xe,[t("div",He,"NT$ "+n(((z=s.grand_total_int)==null?void 0:z.toLocaleString())||0),1),t("div",Je," 未稅："+n(((F=s.subtotal_int)==null?void 0:F.toLocaleString())||0)+" | 稅額："+n(((Y=s.tax_decimal1)==null?void 0:Y.toLocaleString())||0),1)]),t("div",Qe,[l(m,null,{default:o(()=>[(c(),C(ge(p.value.includes(s.purchase_order_no)?"ArrowUp":"ArrowDown")))]),_:2},1024)])],8,je),l(ce,null,{default:o(()=>{var $;return[ye(t("div",Ze,[l(re,{style:{margin:"12px 0"}}),t("div",et,[t("div",tt,[e[7]||(e[7]=t("label",null,"報價單號：",-1)),t("span",null,n(s.quotation_no||"無"),1)]),t("div",at,[e[8]||(e[8]=t("label",null,"交貨地址：",-1)),t("span",null,n(s.delivery_address||"無"),1)]),t("div",st,[e[9]||(e[9]=t("label",null,"建立人員：",-1)),t("span",null,n(s.creator_name||"系統"),1)]),t("div",lt,[e[10]||(e[10]=t("label",null,"確認人員：",-1)),t("span",null,n(s.confirm_purchaser_name||"未確認"),1)])]),t("div",ot,[t("h4",null,"採購明細 ("+n((($=s.items)==null?void 0:$.length)||0)+" 項)",1),l(de,{data:s.items,size:"small",stripe:""},{default:o(()=>[l(g,{prop:"item_name",label:"項目名稱","min-width":"150"}),l(g,{prop:"item_specification",label:"規格說明","min-width":"120"}),l(g,{prop:"item_quantity",label:"數量",width:"80",align:"right"},{default:o(v=>[w(n(v.row.item_quantity),1)]),_:1}),l(g,{prop:"item_unit",label:"單位",width:"60"}),l(g,{prop:"unit_price",label:"單價",width:"100",align:"right"},{default:o(v=>{var x;return[w(n((x=v.row.unit_price)==null?void 0:x.toLocaleString()),1)]}),_:1}),l(g,{label:"小計",width:"120",align:"right"},{default:o(v=>{var x;return[w(" NT$ "+n((x=v.row.line_subtotal)==null?void 0:x.toLocaleString()),1)]}),_:1}),l(g,{prop:"line_status",label:"狀態",width:"80"},{default:o(v=>[l(ie,{type:se(v.row.line_status),size:"small"},{default:o(()=>[w(n(ae(v.row.line_status)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),s.notes?(c(),y("div",nt,[e[11]||(e[11]=t("label",null,"備註：",-1)),t("p",null,n(s.notes),1)])):V("",!0)],512),[[be,p.value.includes(s.purchase_order_no)]])]}),_:2},1024)],2)}),128))]))]),_:1})):V("",!0)])}}});const Et=Re(rt,[["__scopeId","data-v-f2721cf2"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/accounting/Dashboard.vue"]]);export{Et as default};
//# sourceMappingURL=Dashboard-13fbbebf.js.map
