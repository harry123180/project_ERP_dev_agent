import{d as K,n as L,y as G,r as C,p as J,a1 as W,c as m,b as s,e as a,w as e,q as k,ab as b,aP as X,V as $,X as H,m as Q,al as U,aS as Y,o as _,i as d,t as o,g as p,F as Z,s as tt,aJ as et,ao as at,aK as st,av as lt,aw as ot,aj as nt,a4 as rt,am as ut,an as it,_ as dt}from"./index-61294aba.js";/* empty css                   *//* empty css                         *//* empty css               *//* empty css                        */import"./el-tooltip-4ed993c7.js";/* empty css                     *//* empty css               *//* empty css                *//* empty css                             *//* empty css                  */import{a as M,f as v}from"./format-8036aac9.js";const _t={class:"purchase-order-detail"},pt={class:"page-header"},ct={class:"actions"},mt={class:"detail-container"},vt={class:"amount"},ft={key:0,class:"notes"},bt={key:0},yt={key:1},gt={class:"summary"},ht={class:"summary-item"},kt={class:"summary-item"},Et={class:"summary-item"},wt={class:"total"},xt={class:"history-item"},qt={class:"status-change"},Dt={class:"operator"},Ct={key:0,class:"remarks"},Mt=K({__name:"Detail",setup(Tt){const E=L(),w=G(),y=C(!1),l=C({po_number:"",supplier_name:"",status:"",created_at:"",created_by:"",total_amount:0,subtotal:0,tax_amount:0,notes:"",items:[],status_history:[]}),T=J(()=>["order_created"].includes(l.value.status)),P=async()=>{var u;y.value=!0;try{const t=E.params.id,i=await $.getPurchaseOrder(t);l.value={po_number:i.purchase_order_no,supplier_name:i.supplier_name,status:i.purchase_status||"pending",created_at:i.created_at,created_by:"採購員",total_amount:i.grand_total_int||0,subtotal:i.subtotal_int||0,tax_amount:i.tax_decimal1||0,notes:i.notes||"",items:((u=i.items)==null?void 0:u.map(n=>({item_name:n.item_name,spec:n.item_specification,quantity:n.item_quantity,unit_price:n.unit_price,subtotal:n.line_subtotal?n.line_subtotal:n.unit_price*n.item_quantity,status:n.line_status,request_info:n.request_info||null})))||[],status_history:[]},console.log("Purchase order loaded:",l.value)}catch(t){console.error("載入採購單詳情失敗:",t),H.error("載入採購單詳情失敗")}finally{y.value=!1}},S=()=>{w.push(`/purchase-orders/${E.params.id}/edit`)},B=()=>{w.back()},x=u=>({order_created:"",purchased:"success",shipped:"warning",arrived:"info",completed:"success"})[u]||"",q=u=>({order_created:"已建立",purchased:"已採購",shipped:"已出貨",arrived:"已到貨",completed:"已完成"})[u]||u,N=u=>({pending:"info",approved:"success",purchased:"primary",received:"success"})[u]||"",A=u=>({pending:"待處理",approved:"已核准",order_created:"已建立",purchased:"已採購",received:"已收貨"})[u]||u;return W(()=>{P()}),(u,t)=>{var D;const i=Q,n=et,g=at,I=st,f=U,c=lt,O=ot,h=nt,R=rt,V=ut,j=it,z=Y;return _(),m("div",_t,[s("div",pt,[t[2]||(t[2]=s("h1",{class:"page-title"},"採購單詳情",-1)),s("div",ct,[a(i,{onClick:B},{default:e(()=>[...t[0]||(t[0]=[d("返回",-1)])]),_:1}),T.value?(_(),k(i,{key:0,type:"primary",onClick:S},{default:e(()=>[...t[1]||(t[1]=[d(" 編輯 ",-1)])]),_:1})):b("",!0)])]),X((_(),m("div",mt,[a(f,{class:"info-card"},{header:e(()=>[...t[3]||(t[3]=[s("h3",null,"基本資訊",-1)])]),default:e(()=>[a(I,{column:2,border:""},{default:e(()=>[a(n,{label:"採購單號"},{default:e(()=>[d(o(l.value.po_number),1)]),_:1}),a(n,{label:"供應商"},{default:e(()=>[d(o(l.value.supplier_name),1)]),_:1}),a(n,{label:"狀態"},{default:e(()=>[a(g,{type:x(l.value.status)},{default:e(()=>[d(o(q(l.value.status)),1)]),_:1},8,["type"])]),_:1}),a(n,{label:"建立時間"},{default:e(()=>[d(o(p(M)(l.value.created_at)),1)]),_:1}),a(n,{label:"建立人"},{default:e(()=>[d(o(l.value.created_by),1)]),_:1}),a(n,{label:"總金額"},{default:e(()=>[s("span",vt,o(p(v)(l.value.total_amount)),1)]),_:1})]),_:1}),l.value.notes?(_(),m("div",ft,[t[4]||(t[4]=s("h4",null,"備註",-1)),s("p",null,o(l.value.notes),1)])):b("",!0)]),_:1}),a(f,{class:"items-card"},{header:e(()=>[...t[5]||(t[5]=[s("h3",null,"採購項目",-1)])]),default:e(()=>[a(O,{data:l.value.items,stripe:""},{default:e(()=>[a(c,{prop:"item_name",label:"項目名稱",width:"200"}),a(c,{prop:"spec",label:"規格",width:"150"}),a(c,{prop:"quantity",label:"數量",width:"100",align:"center"}),a(c,{prop:"unit_price",label:"單價",width:"120",align:"right"},{default:e(({row:r})=>[d(o(p(v)(r.unit_price)),1)]),_:1}),a(c,{prop:"subtotal",label:"小計",width:"120",align:"right"},{default:e(({row:r})=>[d(o(p(v)(r.subtotal)),1)]),_:1}),a(c,{prop:"status",label:"狀態",width:"100"},{default:e(({row:r})=>[a(g,{type:N(r.status),size:"small"},{default:e(()=>[d(o(A(r.status)),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"請購資訊","min-width":"150"},{default:e(({row:r})=>[r.request_info?(_(),m("div",bt,[s("div",null,"請購單："+o(r.request_info.request_number||"N/A"),1),s("div",null,"請購人："+o(r.request_info.requester||"N/A"),1)])):(_(),m("div",yt,[...t[6]||(t[6]=[s("div",{class:"text-gray-400"},"無請購資訊",-1)])]))]),_:1})]),_:1},8,["data"])]),_:1}),a(f,{class:"summary-card"},{header:e(()=>[...t[7]||(t[7]=[s("h3",null,"金額統計",-1)])]),default:e(()=>[s("div",gt,[a(R,{gutter:20},{default:e(()=>[a(h,{span:8},{default:e(()=>[s("div",ht,[t[8]||(t[8]=s("label",null,"項目小計：",-1)),s("span",null,o(p(v)(l.value.subtotal)),1)])]),_:1}),a(h,{span:8},{default:e(()=>[s("div",kt,[t[9]||(t[9]=s("label",null,"稅額 (5%)：",-1)),s("span",null,o(p(v)(l.value.tax_amount)),1)])]),_:1}),a(h,{span:8},{default:e(()=>[s("div",Et,[t[10]||(t[10]=s("label",null,"總金額：",-1)),s("span",wt,o(p(v)(l.value.total_amount)),1)])]),_:1})]),_:1})])]),_:1}),(D=l.value.status_history)!=null&&D.length?(_(),k(f,{key:0,class:"history-card"},{header:e(()=>[...t[11]||(t[11]=[s("h3",null,"狀態變更歷史",-1)])]),default:e(()=>[a(j,null,{default:e(()=>[(_(!0),m(Z,null,tt(l.value.status_history,(r,F)=>(_(),k(V,{key:F,timestamp:p(M)(r.timestamp)},{default:e(()=>[s("div",xt,[s("div",qt,[t[12]||(t[12]=d(" 狀態變更為： ",-1)),a(g,{type:x(r.status),size:"small"},{default:e(()=>[d(o(q(r.status)),1)]),_:2},1032,["type"])]),s("div",Dt,"操作人："+o(r.operator),1),r.remarks?(_(),m("div",Ct,"備註："+o(r.remarks),1)):b("",!0)])]),_:2},1032,["timestamp"]))),128))]),_:1})]),_:1})):b("",!0)])),[[z,y.value]])])}}});const Kt=dt(Mt,[["__scopeId","data-v-851cad11"],["__file","D:/AWORKSPACE/Github/project_ERP_dev_agent/frontend/src/views/purchase-orders/Detail.vue"]]);export{Kt as default};
//# sourceMappingURL=Detail-7f444345.js.map
