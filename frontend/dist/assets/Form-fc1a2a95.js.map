{"version":3,"file":"Form-fc1a2a95.js","sources":["../../src/views/projects/Form.vue"],"sourcesContent":["<template>\r\n  <div class=\"project-form\">\r\n    <div class=\"page-header\">\r\n      <h1>{{ isEdit ? '編輯專案' : '新增專案' }}</h1>\r\n    </div>\r\n\r\n    <el-card>\r\n      <el-form \r\n        ref=\"formRef\"\r\n        :model=\"form\" \r\n        :rules=\"rules\" \r\n        label-width=\"120px\"\r\n        :disabled=\"loading\"\r\n      >\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"專案代碼\" prop=\"project_code\">\r\n              <el-input \r\n                v-model=\"form.project_code\" \r\n                placeholder=\"請輸入專案代碼（選填）\"\r\n                maxlength=\"20\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"專案名稱\" prop=\"project_name\">\r\n              <el-input \r\n                v-model=\"form.project_name\" \r\n                placeholder=\"請輸入專案名稱\"\r\n                maxlength=\"200\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-form-item label=\"專案描述\" prop=\"description\">\r\n          <el-input \r\n            v-model=\"form.description\" \r\n            type=\"textarea\"\r\n            :rows=\"3\"\r\n            placeholder=\"請輸入專案描述\"\r\n            maxlength=\"500\"\r\n            show-word-limit\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"專案狀態\" prop=\"project_status\">\r\n              <el-select v-model=\"form.project_status\" placeholder=\"請選擇專案狀態\">\r\n                <el-option label=\"進行中\" value=\"ongoing\" />\r\n                <el-option label=\"已完成\" value=\"completed\" />\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"專案預算\" prop=\"budget\">\r\n              <el-input-number \r\n                v-model=\"form.budget\" \r\n                :min=\"0\"\r\n                :precision=\"0\"\r\n                :controls-position=\"'right'\"\r\n                placeholder=\"請輸入專案預算\"\r\n                style=\"width: 100%\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"開始日期\" prop=\"start_date\">\r\n              <el-date-picker\r\n                v-model=\"form.start_date\"\r\n                type=\"date\"\r\n                placeholder=\"選擇開始日期\"\r\n                format=\"YYYY-MM-DD\"\r\n                value-format=\"YYYY-MM-DD\"\r\n                style=\"width: 100%\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"結束日期\" prop=\"end_date\">\r\n              <el-date-picker\r\n                v-model=\"form.end_date\"\r\n                type=\"date\"\r\n                placeholder=\"選擇結束日期\"\r\n                format=\"YYYY-MM-DD\"\r\n                value-format=\"YYYY-MM-DD\"\r\n                style=\"width: 100%\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-divider content-position=\"left\">客戶資訊</el-divider>\r\n\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"客戶名稱\" prop=\"customer_name\">\r\n              <el-input \r\n                v-model=\"form.customer_name\" \r\n                placeholder=\"請輸入客戶名稱\"\r\n                maxlength=\"200\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"客戶部門\" prop=\"customer_department\">\r\n              <el-input \r\n                v-model=\"form.customer_department\" \r\n                placeholder=\"請輸入客戶部門\"\r\n                maxlength=\"100\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"聯絡人\" prop=\"customer_contact\">\r\n              <el-input \r\n                v-model=\"form.customer_contact\" \r\n                placeholder=\"請輸入聯絡人姓名\"\r\n                maxlength=\"100\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"聯絡電話\" prop=\"customer_phone\">\r\n              <el-input \r\n                v-model=\"form.customer_phone\" \r\n                placeholder=\"請輸入聯絡電話\"\r\n                maxlength=\"50\"\r\n              />\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-form-item label=\"客戶地址\" prop=\"customer_address\">\r\n          <el-input \r\n            v-model=\"form.customer_address\" \r\n            placeholder=\"請輸入客戶地址\"\r\n            maxlength=\"500\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"loading\">\r\n            {{ isEdit ? '更新' : '建立' }}\r\n          </el-button>\r\n          <el-button @click=\"handleCancel\">取消</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, reactive, onMounted, computed } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage, FormInstance, FormRules } from 'element-plus'\r\nimport { projectsApi } from '@/api/projects'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst formRef = ref<FormInstance>()\r\nconst loading = ref(false)\r\n\r\nconst isEdit = computed(() => !!route.params.id)\r\n\r\nconst form = reactive({\r\n  project_code: '',\r\n  project_name: '',\r\n  description: '',\r\n  project_status: 'ongoing',\r\n  budget: null as number | null,\r\n  start_date: '',\r\n  end_date: '',\r\n  customer_name: '',\r\n  customer_department: '',\r\n  customer_contact: '',\r\n  customer_phone: '',\r\n  customer_address: ''\r\n})\r\n\r\nconst rules: FormRules = {\r\n  project_name: [\r\n    { required: true, message: '請輸入專案名稱', trigger: 'blur' },\r\n    { min: 2, max: 200, message: '專案名稱長度在 2 到 200 個字符', trigger: 'blur' }\r\n  ],\r\n  project_status: [\r\n    { required: true, message: '請選擇專案狀態', trigger: 'change' }\r\n  ],\r\n  start_date: [\r\n    { required: true, message: '請選擇開始日期', trigger: 'change' }\r\n  ],\r\n  end_date: [\r\n    {\r\n      validator: (rule, value, callback) => {\r\n        if (value && form.start_date && new Date(value) < new Date(form.start_date)) {\r\n          callback(new Error('結束日期不能早於開始日期'))\r\n        } else {\r\n          callback()\r\n        }\r\n      },\r\n      trigger: 'change'\r\n    }\r\n  ],\r\n  budget: [\r\n    { type: 'number', min: 0, message: '預算必須大於等於0', trigger: 'blur' }\r\n  ]\r\n}\r\n\r\nconst loadProject = async () => {\r\n  if (!isEdit.value) return\r\n  \r\n  loading.value = true\r\n  try {\r\n    const projectId = route.params.id as string\r\n    const project = await projectsApi.getProject(projectId)\r\n    \r\n    // 填充表單數據\r\n    Object.keys(form).forEach(key => {\r\n      if (project[key] !== undefined) {\r\n        form[key] = project[key]\r\n      }\r\n    })\r\n  } catch (error) {\r\n    console.error('Failed to load project:', error)\r\n    ElMessage.error('載入專案資料失敗')\r\n    router.push('/projects')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst handleSubmit = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  await formRef.value.validate(async (valid) => {\r\n    if (!valid) return\r\n    \r\n    loading.value = true\r\n    try {\r\n      const data: any = { ...form }\r\n      \r\n      if (isEdit.value) {\r\n        // 更新專案\r\n        await projectsApi.updateProject(route.params.id as string, data)\r\n        ElMessage.success('專案更新成功')\r\n      } else {\r\n        // 創建新專案\r\n        data.project_id = await projectsApi.generateProjectId()\r\n        // 暫時設定管理者為當前用戶 (admin = 1)\r\n        data.manager_id = 1\r\n        await projectsApi.createProject(data)\r\n        ElMessage.success('專案建立成功')\r\n      }\r\n      \r\n      router.push('/projects')\r\n    } catch (error) {\r\n      console.error('Failed to save project:', error)\r\n      ElMessage.error(isEdit.value ? '更新專案失敗' : '建立專案失敗')\r\n    } finally {\r\n      loading.value = false\r\n    }\r\n  })\r\n}\r\n\r\nconst handleCancel = () => {\r\n  router.push('/projects')\r\n}\r\n\r\nonMounted(() => {\r\n  loadProject()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.project-form {\r\n  padding: 20px;\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.page-header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.page-header h1 {\r\n  font-size: 24px;\r\n  margin: 0;\r\n  color: #303133;\r\n}\r\n</style>"],"names":["route","useRoute","router","useRouter","formRef","ref","loading","isEdit","computed","form","reactive","rules","rule","value","callback","loadProject","projectId","project","projectsApi","key","error","ElMessage","handleSubmit","valid","data","handleCancel","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_toDisplayString","_withCtx","_createVNode","_component_el_form","_component_el_row","_component_el_col","_component_el_form_item","_component_el_input","_cache","$event","_component_el_select","_component_el_option","_component_el_input_number","_component_el_date_picker","_createTextVNode","_component_el_button"],"mappings":"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"}