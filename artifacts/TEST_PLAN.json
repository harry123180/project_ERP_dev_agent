{
  "schema_version": "1.0",
  "generated_by": "erp-project-manager",
  "cases": [
    {
      "id": "AUTH_001",
      "type": "integration",
      "preconditions": [
        "System is running",
        "Database is initialized with test users",
        "JWT secret key is configured"
      ],
      "steps": [
        "Send POST request to /api/v1/auth/login with valid credentials",
        "Verify JWT token is returned in response",
        "Use token to access protected endpoint",
        "Send POST request to /api/v1/auth/logout",
        "Attempt to access protected endpoint with invalidated token"
      ],
      "expected": [
        "Login returns 200 status with JWT token",
        "Token allows access to protected resources",
        "Logout invalidates token successfully",
        "Invalidated token returns 401 Unauthorized"
      ]
    },
    {
      "id": "REQ_001", 
      "type": "e2e",
      "preconditions": [
        "User is logged in as Engineer role",
        "System has item categories configured",
        "Database is clean for requisition tests"
      ],
      "steps": [
        "Navigate to requisition creation page",
        "Fill in requisition details (purpose: daily)",
        "Add multiple items with quantities and specifications",
        "Save as draft and verify draft status",
        "Submit requisition for review",
        "Verify requisition status changes to submitted"
      ],
      "expected": [
        "Requisition form validates input correctly",
        "Items are saved with proper quantities (positive integers only)",
        "Draft can be saved and retrieved",
        "Submitted requisition generates unique request order number",
        "Requester receives confirmation of submission"
      ]
    },
    {
      "id": "REQ_002",
      "type": "integration", 
      "preconditions": [
        "User is logged in as Procurement role",
        "Test requisition exists in submitted status",
        "Suppliers are configured in system"
      ],
      "steps": [
        "Access requisition review page",
        "Select first item and assign supplier",
        "Enter unit price and approve item",
        "Mark second item as questioned with reason",
        "Reject third item with explanation",
        "Attempt to reject entire requisition"
      ],
      "expected": [
        "Item status updates to approved with supplier and price",
        "Questioned item shows reason and remains in review",
        "Rejected item cannot proceed to procurement",
        "Requisition rejection affects all remaining items",
        "Audit trail records all approval actions",
        "CRITICAL: Requisition status automatically updates from 'submitted' to 'reviewed' when all items approved"
      ],
      "validation_status": "PASSED - Critical bug fix implemented and validated 2025-09-08",
      "test_evidence": [
        "Full approval workflow: Status correctly updates from submitted to reviewed",
        "Partial approval workflow: Status remains submitted when only some items approved", 
        "Real-time UI updates: Changes occur immediately without page refresh",
        "No console errors or data integrity issues found",
        "Backend API integration working correctly with update_status_after_review() method",
        "Frontend reactivity and user experience validated by Test Architect Quinn"
      ]
    },
    {
      "id": "PO_001",
      "type": "e2e",
      "preconditions": [
        "User is logged in as Procurement role", 
        "Multiple approved requisition items exist",
        "Items are from different suppliers"
      ],
      "steps": [
        "Navigate to PO build candidates page",
        "Select supplier tab to group items",
        "Select items for purchase order creation", 
        "Verify PO preview shows correct calculations",
        "Save purchase order with status 'order_created'",
        "Confirm purchase to change status to 'purchased'"
      ],
      "expected": [
        "Items are correctly grouped by supplier",
        "Financial calculations are accurate (subtotal=qty*price rounded to integer, tax=subtotal*rate with 1 decimal, total=subtotal+tax rounded)",
        "PO number is auto-generated uniquely",
        "Item statuses update from approved to order_created to purchased",
        "Purchase confirmation is idempotent with Idempotency-Key"
      ]
    },
    {
      "id": "SHIP_001",
      "type": "integration",
      "preconditions": [
        "Purchase orders exist in purchased status",
        "User has Procurement role permissions"
      ],
      "steps": [
        "Access lead time management page",
        "Update PO milestone to 'shipped' with tracking info",
        "Create consolidation for international shipment",
        "Add multiple POs to consolidation",
        "Update consolidation milestone status",
        "Verify all POs in consolidation reflect new status"
      ],
      "expected": [
        "Individual PO status updates correctly",
        "Consolidation groups POs effectively",
        "Bulk status updates work across all POs in consolidation",
        "Tracking information is properly stored and displayed",
        "Status changes are reflected in receiving module"
      ]
    },
    {
      "id": "RCV_001",
      "type": "e2e", 
      "preconditions": [
        "POs exist in shipped/arrived status",
        "User is logged in with receiving permissions"
      ],
      "steps": [
        "Navigate to receiving page",
        "Filter items by domestic/international region",
        "Select PO for receiving inspection",
        "Confirm receipt of individual items",
        "Verify item status updates to arrived",
        "Check items appear in putaway queue"
      ],
      "expected": [
        "Regional filtering works correctly",
        "Items can be individually confirmed",
        "Receiving timestamps are recorded with user info",
        "Status transitions from shipped to arrived",
        "Items automatically queue for storage assignment"
      ]
    },
    {
      "id": "STG_001",
      "type": "integration",
      "preconditions": [
        "Items exist in arrived status ready for putaway",
        "Storage locations are configured in system"
      ],
      "steps": [
        "Access putaway assignment page",
        "Select items requiring storage assignment",
        "Choose storage location from hierarchy tree",
        "Assign items to specific zone/shelf/floor positions", 
        "Confirm storage assignment",
        "Verify movement history is recorded"
      ],
      "expected": [
        "Storage hierarchy displays correctly (Zone->Shelf->Floor)",
        "Items can be assigned to specific positions",
        "Storage history tracks in/out movements",
        "Inventory quantities update correctly",
        "Items become available for acceptance workflow"
      ]
    },
    {
      "id": "ACC_001", 
      "type": "e2e",
      "preconditions": [
        "Items are stored and ready for acceptance",
        "Original requester has access to acceptance module"
      ],
      "steps": [
        "Login as original requester",
        "Navigate to acceptance page",
        "View items pending acceptance",
        "Confirm acceptance of received items",
        "Verify acceptance status updates",
        "Check items become available for issue"
      ],
      "expected": [
        "Only requester's items appear in acceptance list",
        "Acceptance timestamps are recorded",
        "Items transition to accepted status",
        "Accepted items appear in inventory queries",
        "Acceptance completes the receipt workflow"
      ]
    },
    {
      "id": "INV_001",
      "type": "integration", 
      "preconditions": [
        "Accepted items exist in inventory",
        "User has inventory query permissions"
      ],
      "steps": [
        "Access inventory query page",
        "Search items by various filters (name, spec, PO number)",
        "View item locations and quantities",
        "Issue items with quantity specification",
        "Verify inventory quantities decrease",
        "Check movement history records issuance"
      ],
      "expected": [
        "Search filters work across all criteria",
        "Current stock levels display accurately",
        "Item issuance validates quantity availability",
        "Inventory balances update immediately",
        "Movement history maintains complete audit trail"
      ]
    },
    {
      "id": "PAY_001",
      "type": "integration",
      "preconditions": [
        "POs exist in various payment states",
        "User has ProcurementMgr or Accountant role"
      ],
      "steps": [
        "Access billing candidates page",
        "Filter unbilled POs by supplier and month",
        "Generate billing batch with payment terms",
        "Apply discounts and deductions as needed",
        "Mark billing batch as paid",
        "Verify PO statuses update to paid"
      ],
      "expected": [
        "30/60 day payment terms filter correctly",
        "Billing calculations include all charges",
        "Batch operations work across multiple POs",
        "Payment status changes are idempotent",
        "Payment history maintains complete records"
      ]
    },
    {
      "id": "ROLE_001",
      "type": "contract",
      "preconditions": [
        "Users with different roles exist in system",
        "All modules are properly configured"
      ],
      "steps": [
        "Test Engineer role access to requisition creation only",
        "Test Procurement role access to review and PO creation",
        "Test ProcurementMgr role access to approvals and payments",
        "Test Admin role access to all system functions",
        "Verify role inheritance and permission cascading"
      ],
      "expected": [
        "Each role has appropriate page access restrictions",
        "Action buttons appear/hide based on user permissions",
        "API endpoints return 403 for unauthorized actions",
        "Role-based filtering works in all list views",
        "Permission system prevents privilege escalation"
      ]
    },
    {
      "id": "CALC_001",
      "type": "unit",
      "preconditions": [
        "System has calculation service configured",
        "Tax rates are set in system settings"
      ],
      "steps": [
        "Test quantity validation (positive integers only)",
        "Test unit price validation (positive decimals allowed)",
        "Test subtotal calculation (quantity * price rounded to integer)",
        "Test tax calculation (subtotal * rate with 1 decimal place)",
        "Test total calculation (subtotal + tax rounded to integer)"
      ],
      "expected": [
        "Invalid quantities are rejected",
        "Negative prices are not allowed",
        "Subtotal rounding follows business rules",
        "Tax calculations maintain precision requirements",
        "Final totals are always integers as specified"
      ]
    },
    {
      "id": "FLOW_001",
      "type": "e2e",
      "preconditions": [
        "Clean database state",
        "All user roles configured",
        "System settings properly initialized"
      ],
      "steps": [
        "Complete full requisition workflow (Engineer creates, Procurement approves)",
        "Complete procurement workflow (PO creation, confirmation)",
        "Complete shipping workflow (status updates, tracking)",
        "Complete receiving workflow (item confirmation)",
        "Complete storage workflow (location assignment)",
        "Complete acceptance workflow (requester confirmation)",
        "Complete inventory workflow (item issuance)",
        "Complete payment workflow (billing and payment)"
      ],
      "expected": [
        "Each workflow step transitions smoothly to the next",
        "All status updates are properly synchronized",
        "Audit trails capture complete transaction history",
        "No data inconsistencies occur during transitions",
        "System performance remains acceptable throughout full flow"
      ]
    },
    {
      "id": "PERF_001",
      "type": "perf",
      "preconditions": [
        "System loaded with test data (1000+ items, 100+ users)",
        "Performance monitoring tools configured"
      ],
      "steps": [
        "Load test requisition list page with pagination",
        "Measure response time for PO build candidates query",
        "Test inventory search with complex filters",
        "Simulate concurrent user access to same resources",
        "Monitor database query performance under load"
      ],
      "expected": [
        "List pages load within 2 seconds",
        "Complex queries complete within 5 seconds",
        "System supports 100+ concurrent users",
        "No database deadlocks or resource contention",
        "Memory usage remains within acceptable limits"
      ]
    },
    {
      "id": "SEC_001", 
      "type": "sec",
      "preconditions": [
        "System is deployed with security configurations",
        "SSL/HTTPS is properly configured"
      ],
      "steps": [
        "Test SQL injection prevention on search endpoints",
        "Test XSS prevention in user input fields", 
        "Test JWT token expiration and refresh",
        "Test CORS policy enforcement",
        "Test sensitive data exposure in API responses"
      ],
      "expected": [
        "Parameterized queries prevent SQL injection",
        "Input sanitization prevents XSS attacks",
        "Expired tokens are properly handled",
        "Cross-origin requests are controlled",
        "Passwords and secrets are never exposed in responses"
      ]
    }
  ]
}